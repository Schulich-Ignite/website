import $ from"jquery";import Popper from"popper.js";import Util from"./util";const Dropdown=(t=>{const e="dropdown",n="bs.dropdown",o=".bs.dropdown",s=t.fn[e],r=new RegExp("38|40|27"),i={HIDE:"hide.bs.dropdown",HIDDEN:"hidden.bs.dropdown",SHOW:"show.bs.dropdown",SHOWN:"shown.bs.dropdown",CLICK:"click.bs.dropdown",CLICK_DATA_API:"click.bs.dropdown.data-api",KEYDOWN_DATA_API:"keydown.bs.dropdown.data-api",KEYUP_DATA_API:"keyup.bs.dropdown.data-api"},a="disabled",l="show",h="dropup",d="dropright",p="dropleft",c="dropdown-menu-right",u="dropdown-menu-left",f="position-static",_='[data-toggle="dropdown"]',g=".dropdown form",m=".dropdown-menu",w=".navbar-nav",C=".dropdown-menu .dropdown-item:not(.disabled)",b="top-start",A="top-end",P="bottom-start",y="bottom-end",v="right-start",D="left-start",E={offset:0,flip:!0,boundary:"scrollParent"},I={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)"};class N{constructor(t,e){this._element=t,this._popper=null,this._config=this._getConfig(e),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}static get VERSION(){return"4.0.0"}static get Default(){return E}static get DefaultType(){return I}toggle(){if(this._element.disabled||t(this._element).hasClass(a))return;const e=N._getParentFromElement(this._element),n=t(this._menu).hasClass(l);if(N._clearMenus(),n)return;const o={relatedTarget:this._element},s=t.Event(i.SHOW,o);if(t(e).trigger(s),!s.isDefaultPrevented()){if(!this._inNavbar){if(void 0===Popper)throw new TypeError("Bootstrap dropdown require Popper.js (https://popper.js.org)");let n=this._element;t(e).hasClass(h)&&(t(this._menu).hasClass(u)||t(this._menu).hasClass(c))&&(n=e),"scrollParent"!==this._config.boundary&&t(e).addClass(f),this._popper=new Popper(n,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===t(e).closest(w).length&&t("body").children().on("mouseover",null,t.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),t(this._menu).toggleClass(l),t(e).toggleClass(l).trigger(t.Event(i.SHOWN,o))}}dispose(){t.removeData(this._element,n),t(this._element).off(o),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}update(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}_addEventListeners(){t(this._element).on(i.CLICK,t=>{t.preventDefault(),t.stopPropagation(),this.toggle()})}_getConfig(n){return n={...this.constructor.Default,...t(this._element).data(),...n},Util.typeCheckConfig(e,n,this.constructor.DefaultType),n}_getMenuElement(){if(!this._menu){const e=N._getParentFromElement(this._element);this._menu=t(e).find(m)[0]}return this._menu}_getPlacement(){const e=t(this._element).parent();let n=P;return e.hasClass(h)?(n=b,t(this._menu).hasClass(c)&&(n=A)):e.hasClass(d)?n=v:e.hasClass(p)?n=D:t(this._menu).hasClass(c)&&(n=y),n}_detectNavbar(){return t(this._element).closest(".navbar").length>0}_getPopperConfig(){const t={};"function"==typeof this._config.offset?t.fn=t=>(t.offsets={...t.offsets,...this._config.offset(t.offsets)||{}},t):t.offset=this._config.offset;return{placement:this._getPlacement(),modifiers:{offset:t,flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}}}static _jQueryInterface(e){return this.each((function(){let o=t(this).data(n);if(o||(o=new N(this,"object"==typeof e?e:null),t(this).data(n,o)),"string"==typeof e){if(void 0===o[e])throw new TypeError(`No method named "${e}"`);o[e]()}}))}static _clearMenus(e){if(e&&(3===e.which||"keyup"===e.type&&9!==e.which))return;const o=t.makeArray(t(_));for(let s=0;s<o.length;s++){const r=N._getParentFromElement(o[s]),a=t(o[s]).data(n),h={relatedTarget:o[s]};if(!a)continue;const d=a._menu;if(!t(r).hasClass(l))continue;if(e&&("click"===e.type&&/input|textarea/i.test(e.target.tagName)||"keyup"===e.type&&9===e.which)&&t.contains(r,e.target))continue;const p=t.Event(i.HIDE,h);t(r).trigger(p),p.isDefaultPrevented()||("ontouchstart"in document.documentElement&&t("body").children().off("mouseover",null,t.noop),o[s].setAttribute("aria-expanded","false"),t(d).removeClass(l),t(r).removeClass(l).trigger(t.Event(i.HIDDEN,h)))}}static _getParentFromElement(e){let n;const o=Util.getSelectorFromElement(e);return o&&(n=t(o)[0]),n||e.parentNode}static _dataApiKeydownHandler(e){if(/input|textarea/i.test(e.target.tagName)?32===e.which||27!==e.which&&(40!==e.which&&38!==e.which||t(e.target).closest(m).length):!r.test(e.which))return;if(e.preventDefault(),e.stopPropagation(),this.disabled||t(this).hasClass(a))return;const n=N._getParentFromElement(this),o=t(n).hasClass(l);if(!o&&(27!==e.which||32!==e.which)||o&&(27===e.which||32===e.which)){if(27===e.which){const e=t(n).find(_)[0];t(e).trigger("focus")}return void t(this).trigger("click")}const s=t(n).find(C).get();if(0===s.length)return;let i=s.indexOf(e.target);38===e.which&&i>0&&i--,40===e.which&&i<s.length-1&&i++,i<0&&(i=0),s[i].focus()}}return t(document).on(i.KEYDOWN_DATA_API,_,N._dataApiKeydownHandler).on(i.KEYDOWN_DATA_API,m,N._dataApiKeydownHandler).on(`${i.CLICK_DATA_API} ${i.KEYUP_DATA_API}`,N._clearMenus).on(i.CLICK_DATA_API,_,(function(e){e.preventDefault(),e.stopPropagation(),N._jQueryInterface.call(t(this),"toggle")})).on(i.CLICK_DATA_API,g,t=>{t.stopPropagation()}),t.fn[e]=N._jQueryInterface,t.fn[e].Constructor=N,t.fn[e].noConflict=function(){return t.fn[e]=s,N._jQueryInterface},N})($);export default Dropdown;