<!doctype html><html style=overflow-x:hidden><head><meta charset=utf-8><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","author":"Schulich Ignite","name":"It\u0027s caches all the way down","dateCreated":"2023-44-06","text":"Nostalgia can be very powerful, looking back at the world can make people feel warm and fuzzy inside. However, one thing people are not nostalgic of is how long computers used to take to do things.","image":"\/img\/blog\/whiteboard-2.jpg"}</script><title>It's caches all the way down | Schulich Ignite</title><link rel="shortcut icon" href=https://schulichignite.com/img/favicon.ico type=image/x-icon><link rel=icon href=https://schulichignite.com/img/favicon.ico type=image/x-icon><meta property="og:title" content=" It's caches all the way down | Schulich Ignite Blog "><meta property="og:type" content="website"><meta property="og:url" content=" https://schulichignite.com/blog/its-caches-all-the-way-down/ "><meta property="og:image" content="/img/blog/whiteboard-2.jpg "><meta name=Description content=" It's caches all the way down; Nostalgia can be very powerful, looking back at the world can make people feel warm and fuzzy inside. However, one thing people are not nostalgic of is how long computers used to take to do things. "><meta property="og:description" content=" It's caches all the way down; Nostalgia can be very powerful, looking back at the world can make people feel warm and fuzzy inside. However, one thing people are not nostalgic of is how long computers used to take to do things. "><link href="https://fonts.googleapis.com/css2?family=Raleway:wght@900&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Encode+Sans+Semi+Condensed:wght@900&display=swap" rel=stylesheet><link href=https://unpkg.com/video.js@7/dist/video-js.min.css rel=stylesheet><link href=https://unpkg.com/@videojs/themes@1/dist/sea/index.css rel=stylesheet><link rel=stylesheet href=https://schulichignite.com/css/index.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/vs2015.min.css integrity="sha512-mtXspRdOWHCYp+f4c7CkWGYPPRAhq9X+xCvJMUBVAb6pqA4U8pxhT3RWT3LP3bKbiolYL2CkL1bSKZZO4eeTew==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css></head><nav class="navbar sticky-top navbar-expand-lg navbar-dark bg-dark"><a class=navbar-brand href=../../><img src=https://schulichignite.com/img/logos/ignite.svg width=40 height=60 alt="Schulich ignite logo">
<span class=brand-name>Schulich Ignite</span></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Sessions</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=../../beginner>Ignite Beginner</a>
<a class=dropdown-item href=../../flare>Ignite Flare</a>
<a class=dropdown-item href=../../scorch>Ignite Scorch</a></div></li></li><li class=nav-item><a class=nav-link href=https://forms.gle/ZJoDAbcTf1M3NBxYA target=_blank rel="noopener noreferrer">Mailing list</a></li><li class=nav-item><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Media</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=../../blog>Blog</a>
<a class=dropdown-item href=../../language>Languages</a>
<a class=dropdown-item href=../../definitions>Definitions</a></div></li></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>About</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=../../mission>Our Mission</a>
<a class=dropdown-item href=../../team>Our Team</a></li><li class=nav-item><a class=nav-link href=../../contact>Contact</a></li></ul></div></nav><body><div class=diagonal-header><div class=mainheader>Blog</div><div class="subheader dates d-none d-sm-block"><span class=long-dates>Monday, Apr 3, 2023</span>
<span class=short-dates>04/03/23</span></div></div><section class=section><img class="card-img-top large-image blog-hero-image" src=../../img/blog/whiteboard-2.jpg><div class=container><div class=row><div class="card no-background"><div class=card-body><h1 class=card-title>It's caches all the way down</h1><h3 style=font-size:1em;color:#787878>Why calculate when you can just read!</h3><a class="btn btn-secondary my-2" href=../../blog>&larr; Go back to blog</a><div id=article-info class=card><div class=row><div class=col-md-6><div class=card-body><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#what-is-a-cache>What is a cache?</a></li><li><a href=#a-note-about-the-examples>A note about the examples</a></li><li><a href=#simple-example-memoization>Simple example (memoization)</a></li><li><a href=#prefetchespre-caching>Prefetches/Pre-caching</a></li><li><a href=#layers-of-caches>Layers of caches</a><ul><li><a href=#deviceos-cache>Device/OS cache</a></li><li><a href=#browser-cache>Browser cache</a></li><li><a href=#servercdn-cache>Server/CDN cache</a></li><li><a href=#full-example>Full Example</a></li></ul></li><li><a href=#issues-with-caches>Issues with caches</a></li><li><a href=#cache-invalidation-strategies>Cache invalidation strategies</a><ul><li><a href=#fixed-length>Fixed-length</a></li><li><a href=#time-basedttl>Time-based/TTL</a></li><li><a href=#updatepush-based>Update/Push-based</a></li><li><a href=#event-based>Event based</a></li></ul></li></ul></nav></p></div></div><div class=col-md-6><div class=card-body><p class=card-text><i class="bi bi-calendar2-week-fill"></i> <time>Monday, Apr 3, 2023</time></p><p class=card-text><i class="bi bi-stopwatch-fill"></i><em>~13 Minute Read</em><br><em><i class="bi bi-tags-fill"></i></em>
<a href=https://schulichignite.com/tags/optimization/>optimization</a>,
<a href=https://schulichignite.com/tags/web/>web</a>,
<a href=https://schulichignite.com/tags/scorch/>scorch</a>,
<a href=https://schulichignite.com/tags/theory/>theory</a>,
<a href=https://schulichignite.com/tags/terminology/>terminology</a></p><i class="bi bi-file-code-fill text-primary"></i>
<a href=https://schulichignite.com/language/python/>python</a>,
<a href=https://schulichignite.com/language/javascript/>javascript</a><h4>Author(s) information</h4><div id=author-information><a href=https://schulichignite.com/authors/kieran-wood/ target=_blank rel="noopener noreferrer"><img width=100rem src=../../img/blog/avatars/kieran.jpg alt></a><h6 class=card-title><a href=https://schulichignite.com/authors/kieran-wood/ target=_blank rel="noopener noreferrer"><br>Kieran Wood</a></h6><div id=author-icons><a href=mailto:kieran@canadiancoding.ca><i class="bi bi-envelope-fill"></i></a>
<a href=https://github.com/descent098 target=_blank><i class="bi bi-github"></i></a>
<a href=https://linkedin.com/in/kieran-wood target=_blank><i class="bi bi-linkedin"></i></a>
<a href=https://kieranwood.ca target=_blank><i class="bi bi-globe"></i></a></div><div class=text-primary style=max-width:40ch><p>I&rsquo;m a computer science major, with a minor in philosophy. I love to do open source work, especially in scripting, automation, web development, API&rsquo;s, CLI&rsquo;s and dev ops!</p></div></div></div></div></div></div></div><hr><div id=article-content class="card-text blog-text"><p>Nostalgia can be very powerful, looking back at the world can make people feel warm and fuzzy inside. However, one thing people are not nostalgic of is how long computers used to take to do things. People want fast computers. No one misses browsers taking minutes to start, or computers taking 10&rsquo;s of minutes to boot. As computers have become more important in people&rsquo;s lives programmers have been chasing ways to make things faster.</p><p>algorithmic optimizations, data structures, faster hardware, all of these things make computers faster. They let you run your code faster and faster. But the absolute fastest way to compute something is to not have to compute it in the first place.</p><p>Most of what we want to do in programming is redundant. It&rsquo;s very rare there is something completely unique that someone is doing. The whole purpose of functions is based around this concept. We don&rsquo;t want to type the same code over and over again. So how do we avoid repeating ourselves? and how do we use this to make things faster?</p><h2 id=what-is-a-cache>What is a cache?</h2><p>A cache is basically a system where you store something you know you will need for later. Imagine you work in a bakery. If you wait until someone orders a loaf of bread to cook it, then now every person who comes into your store has to wait for you to cook the loaf before they can leave. Instead if there&rsquo;s usually 10 people who come in to buy loaves of bread, you can pre-cook them, and have them ready to buy.</p><p>A cache is the same idea. Let&rsquo;s say you have a website with 25 pages, instead of having to open the file every time a user asks for the page you could just read the most popular pages (let&rsquo;s say 10) and store them in memory. This way whenever people ask for those pages you don&rsquo;t have to go and fetch them because you can just grab them from memory.</p><h2 id=a-note-about-the-examples>A note about the examples</h2><p>The examples all have a fake database system. This is not real code that will run. This would be replaced with however you actually access your data in code. It&rsquo;s just there to help illustrate a point. Here are the functions and the info about them</p><ul><li><code>database.connect()</code>; Returns an object with the database that has <code>.get(table, key)</code> and <code>.store(table, key, value)</code> methods</li><li><code>db.get(table,key)</code>; A method on the database object that gets the information from a specified table with a given key. For example <code>db.get("user", userID)</code> gets data from the user table that has a given user ID</li><li><code>db.store(table, key, value)</code>; A method on the database object that stores information in a given table for a given key with a given value. For example <code>db.store("user", user_id, data)</code>, stores a key at <code>user_id</code> in the <code>user</code> table with the <code>data</code> provided</li></ul><h2 id=simple-example-memoization>Simple example (memoization)</h2><p>One of the simplest forms of caching is called memoization. Essentially you can have a function that takes in some parameters, and on the first run store the result in something like a hashmap/dictionary/list/array to look up the next time the function is called with the same parameters. For example let&rsquo;s say you have a function that gets data about a user from a database by an id (an integer). Something like this:</p><p><code>js</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUser</span>(<span style=color:#a6e22e>userID</span>){
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Connect and get database object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>connect</span>(); 
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Query for user and return data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#a6e22e>userID</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>python</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_user</span>(user_id: int):
</span></span><span style=display:flex><span>    <span style=color:#75715e># Connect and get database object</span>
</span></span><span style=display:flex><span>    db <span style=color:#f92672>=</span> database<span style=color:#f92672>.</span>connect() 
</span></span><span style=display:flex><span>    <span style=color:#75715e># Query for user and return data</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> db<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;user&#34;</span>, user_id)
</span></span></code></pre></div><p>In these two snippets there&rsquo;s some sort of database system we need to connect to, then query for the data, and return it. This is fine, but what if we have 1000 queries at once? or the database is in one country, and the server is in another? We now have to wait for the connection every time. Often with something like this we might be making duplicate calls, like for example if there&rsquo;s a profile page, or some user data that shows up across an app (profile pic etc.). What if instead we could store the results of the queries so that even just duplicate queries don&rsquo;t need to happen. Here&rsquo;s how we could do this:</p><p><code>js</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Map</span>(); <span style=color:#75715e>// Store results of user queries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUser</span>(<span style=color:#a6e22e>userID</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>userID</span>)){ <span style=color:#75715e>// New ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// Connect and get database object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>connect</span>(); 
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Query for user
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#a6e22e>userID</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Store data for next time
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>userID</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>userID</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>python</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>users <span style=color:#f92672>=</span> dict() <span style=color:#75715e># Store results of user queries</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_user</span>(user_id: int):
</span></span><span style=display:flex><span>    user_data <span style=color:#f92672>=</span> users<span style=color:#f92672>.</span>get(user_id, <span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> user_data: <span style=color:#75715e># New user ID</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Connect and get database object</span>
</span></span><span style=display:flex><span>        db <span style=color:#f92672>=</span> database<span style=color:#f92672>.</span>connect() 
</span></span><span style=display:flex><span>        <span style=color:#75715e># Query for user</span>
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> db<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;user&#34;</span>, user_id)
</span></span><span style=display:flex><span>        <span style=color:#75715e># Store for next time</span>
</span></span><span style=display:flex><span>        users[user_id] <span style=color:#f92672>=</span> data 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> data
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> user_data
</span></span></code></pre></div><p>So if we called the function with the user ID 1, it will check if 1 exists in the map/dictionary, since it&rsquo;s empty at the start it will then go and connect to the database, get the data and add it to the map/dictionary. Later on if we called the function again with the ID of 1 it would check the map/dictionary, see the value and just return it right away.</p><p>Python does have a built in one-liner to do this sort of thing inside <a href=https://docs.python.org/3/library/functools.html#functools.cache>the functools package</a>.</p><h2 id=prefetchespre-caching>Prefetches/Pre-caching</h2><p>Memoization is great, but there are tons of other caching strategies that can be more useful. For example let&rsquo;s say you run a ticket app for buying movie tickets. If most people will buy a ticket 1 hour in advance of the showtime, you might want to cache the data for each movie in the system 1 hour before showtime since it&rsquo;s likely to be needed then.</p><p>This method is called pre-fetching. Essentially you are guessing based on trends when you will need data, and preparing the most likely data you will need ahead of time. This can help in systems where you might end up with a lot of stress all at once, like for example game servers where the most popular time iis 5-8pm in each country because that&rsquo;s when people get home from work/school. So you can rotate prefetching server data for each country around when this peak time is!</p><h2 id=layers-of-caches>Layers of caches</h2><p>There is rarely a system you will run into that only has one cache. There will often be multiple caches for multiple purposes interacting with each other. You might make a request for a webpage that compiles it&rsquo;s data from a few dozen caches all at once.</p><p>Let&rsquo;s examine what might happen for example when using a browser to get a webpage.</p><h3 id=deviceos-cache>Device/OS cache</h3><p>Your operating system on the device you&rsquo;re using to read this article will have tons of caches built in. These device/OS caches have tons of use cases. For example you may cache the information of bluetooth devices you have connected to in the past, so you don&rsquo;t have to re-ask the device for it&rsquo;s information every time you pair it.</p><h3 id=browser-cache>Browser cache</h3><p>Now that you have the device level caches, the browser itself will often have it&rsquo;s own caches. It might maintain stored information about you (passwords, name, address etc.), <a href=https://www.cloudflare.com/en-ca/learning/dns/what-is-dns/>DNS information</a>, and even caches of pages you&rsquo;ve recently visited, so it doesn&rsquo;t have to even go to the network for every request.</p><h3 id=servercdn-cache>Server/CDN cache</h3><p>Now that you&rsquo;ve made the request for a page on the browser, the page you get returned back, might even just be a cache. Sometimes this comes in the form of caching like we&rsquo;ve seen (memoization etc.), or it might use a CDN. A CDN is basically a system that exists just to store static (unchanging) content to be distributed to users quickly. This means static pages are stored, and the server running the app doesn&rsquo;t even get asked for the content, instead the CDN just gives it old cached copies.</p><h3 id=full-example>Full Example</h3><p>So if we were to request <a href=https://schulichignite.com>https://schulichignite.com</a> for example in a browser, here are some caches we <strong>might</strong> run into:</p><ol><li>Your OS cache for DNS; DNS is the system that turns domain names (like schulichignite.com) into something useful for your computer (IP address). Your operating system will typically have an internal cache for common DNS entries (google, microsoft etc.). Likewise there will be some caching as part of your home network and how you connect to the internet.</li><li>Your browser cache; Next as your browser is making the request it might use the <strong>browser&rsquo;s</strong> DNS cache to see if you&rsquo;ve visited the domain before, and will use the stored value instead. On top of that even if it does go to the DNS it will also check the <em>page cache</em> in your browser to see if you&rsquo;ve been to the site recently, and if you have to show you a cached copy it stores on your device.</li><li>Server caches; Now assuming you didn&rsquo;t get served the page from the browser&rsquo;s cache you may find that the server you request the page from has the page stored in one of it&rsquo;s caches, or in a CDN. At this point it will return the cached version of the page back to you, and your browser will take the response and cache it so it will load from disk next time.</li></ol><p>At this point just making that one request could be 10&rsquo;s to 100&rsquo;s of caches that are returning your value. Theoretically speaking you might end up with a request that actually isn&rsquo;t processed at all with the typical code and the whole experience is just retrieved from a cache!</p><h2 id=issues-with-caches>Issues with caches</h2><p>We&rsquo;ve talked about adding to caches, but the big problem with caches is <em>cache invalidation</em>. We&rsquo;re fundamentally storing data about a thing in the assumption that the data should stay the same, and therefore only needs to be checked once. The problem with this is that data doesn&rsquo;t stay the same. People change their name on their profile, they update their picture etc. and if everything is cached forever, then those updates aren&rsquo;t possible.</p><p>Cache invalidation is an incredibly hard problem:</p><blockquote><p>There are only two hard things in computer science: cache invalidation and naming things. - Phil Karlton</p></blockquote><p>The question is basically &ldquo;How much of the data we&rsquo;re guessing will be useful later should we be keeping around, and for how long is it useful?&rdquo;. One of the most common solutions is to pick a cap, for example only cache 200 pieces of user info at a time, or limit it to only X number of Mb of data etc.</p><p>One incredibly common option in webdev is TTL (time to live), which is often set to something like 10 mins. This means for each user the caches on their system are valid for 10 mins, then they are <strong>all</strong> purged and remade.</p><p>Another common problem where you can run into issues is when <a href=https://blog.twitter.com/engineering/en_us/topics/open-source/2021/dropping-cache-didnt-drop-cache>you think you&rsquo;re clearing your cache properly, and aren&rsquo;t</a>.</p><p>In fact the common joke about turning a computer system on and off again largely comes from caches. Often times programs store things in memory, which on your system is then stored in RAM. RAM will automatically purge it&rsquo;s entire cache when it loses power. This is why turning computers off and on again is sometimes handy!</p><h2 id=cache-invalidation-strategies>Cache invalidation strategies</h2><p>There are tons of cache invalidation strategies you can use to make sure your data is correct, while still getting some of the performance benefits of caching. There&rsquo;s not enough time to cover them all, and you will likely on most projects want to employ more than one of these, but here are a few approaches.</p><h3 id=fixed-length>Fixed-length</h3><p>Essentially this system is what we&rsquo;ve been talking about all this time, except we get rid of items when the cache reaches a certain size. This can be very important in systems with limited resources. You essentially just check if the cache has more items than a set threshold, and if it does you can either do:</p><ul><li>FIFO (Queue): First in First out, essentially you delete the oldest items first as you go</li><li>LIFO (Stack): Last in First out, This means you delete the newest items first as you go</li></ul><p>Depending on what you need. Keep in mind that some of the data types (maps, dictionaries etc.) in languages are <strong>unordered</strong>. This means deleting the &ldquo;first&rdquo; key might be just deleting the first key alphabetically, or randomly, not necessarily the first key entered.</p><h3 id=time-basedttl>Time-based/TTL</h3><p>We already talked about TTL (time to live), this basically says &ldquo;Hey this cache is valid for the next X mins/hours/days&rdquo;. When people make a request the server will check if the current date & time are <strong>before</strong> the expiry, and if they are after they will update the cache. It might look something like this:</p><pre class=mermaid>
flowchart TD
    A[User] -->|Request site| B(Server)
    B --> C{See if current time >= expiry}
    C -->|No| D[Cache]
    D -->|Return stored result to user| A
    C -->|Yes| E{Cache is invalid}
    E --Request data then update cache & expiry-->D
</pre><p>With our earlier code, we could update it to expire after 10 mins:</p><p><code>js</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Map</span>(); <span style=color:#75715e>// Store results of user queries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUser</span>(<span style=color:#a6e22e>userID</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>userID</span>)){ <span style=color:#75715e>// New ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// Connect and get database object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>connect</span>(); 
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Query for user
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#a6e22e>userID</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Store data for next time
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>userData</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Map</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>userData</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;data&#34;</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Set expiry
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MINUTESTOMILISECONDS</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>60000</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// NOTE: To add 10 mins you need to add 10 mins worth of miliseconds
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>tenMinsFromNow</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(Date.<span style=color:#a6e22e>now</span>() <span style=color:#f92672>+</span> (<span style=color:#ae81ff>10</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>MINUTESTOMILISECONDS</span>))
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>userData</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;expiry&#34;</span>, <span style=color:#a6e22e>tenMinsFromNow</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>userID</span>, <span style=color:#a6e22e>userData</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>userData</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;data&#34;</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>            <span style=color:#75715e>//Check if cache is valid
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (Date.<span style=color:#a6e22e>now</span>()<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>userID</span>).<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;expiry&#34;</span>)){ 
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Connect and get database object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>connect</span>(); 
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Query for user
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#a6e22e>userID</span>);
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Store data for next time
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#a6e22e>userData</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Map</span>();
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>userData</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;data&#34;</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Set expiry
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MINUTESTOMILISECONDS</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>60000</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// NOTE: To add 10 mins you need to add 10 mins worth of miliseconds
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#a6e22e>tenMinsFromNow</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(Date.<span style=color:#a6e22e>now</span>() <span style=color:#f92672>+</span> (<span style=color:#ae81ff>10</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>MINUTESTOMILISECONDS</span>)) 
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>userData</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;expiry&#34;</span>, <span style=color:#a6e22e>tenMinsFromNow</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>userID</span>, <span style=color:#a6e22e>userData</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>userID</span>).<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;data&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>python</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime, timedelta
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>users <span style=color:#f92672>=</span> dict() <span style=color:#75715e># Store results of user queries</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_user</span>(user_id: int):
</span></span><span style=display:flex><span>    user_data <span style=color:#f92672>=</span> users<span style=color:#f92672>.</span>get(user_id, <span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> user_data: <span style=color:#75715e># New user ID</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Connect and get database object</span>
</span></span><span style=display:flex><span>        db <span style=color:#f92672>=</span> database<span style=color:#f92672>.</span>connect() 
</span></span><span style=display:flex><span>        <span style=color:#75715e># Query for user</span>
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> db<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;user&#34;</span>, user_id)
</span></span><span style=display:flex><span>        <span style=color:#75715e># Store for next time</span>
</span></span><span style=display:flex><span>        users[user_id] <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;data&#34;</span>:data, <span style=color:#e6db74>&#34;expiry&#34;</span>: datetime<span style=color:#f92672>.</span>now()<span style=color:#f92672>+</span>timedelta(minutes<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>)}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> users[user_id][<span style=color:#e6db74>&#34;data&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> datetime<span style=color:#f92672>.</span>now() <span style=color:#f92672>&gt;</span> users[user_id][<span style=color:#e6db74>&#34;expiry&#34;</span>]: <span style=color:#75715e># Check if cache is valid</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># Connect and get database object</span>
</span></span><span style=display:flex><span>            db <span style=color:#f92672>=</span> database<span style=color:#f92672>.</span>connect() 
</span></span><span style=display:flex><span>            <span style=color:#75715e># Query for user</span>
</span></span><span style=display:flex><span>            data <span style=color:#f92672>=</span> db<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;user&#34;</span>, user_id)
</span></span><span style=display:flex><span>            <span style=color:#75715e># Store for next time</span>
</span></span><span style=display:flex><span>            users[user_id] <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;data&#34;</span>:data, <span style=color:#e6db74>&#34;expiry&#34;</span>: datetime<span style=color:#f92672>.</span>now()<span style=color:#f92672>+</span>timedelta(minutes<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>)}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> users[user_id][<span style=color:#e6db74>&#34;data&#34;</span>]
</span></span></code></pre></div><p>You can also use this for pre-fetching data. For example maybe you have users across the world, and you know people will use your service at 6pm <strong>IN THEIR TIMEZONE</strong>, so you can clear and fill your cache with people in different regions at 5:55pm their time. This can help mitigate outages if your system can&rsquo;t handle the load of people all trying to call the function at the same time!</p><p>This approach is &ldquo;easy&rdquo; to implement, but it comes with a ton of problems:</p><ul><li><strong>Time is relative;</strong> This isn&rsquo;t a physics rant, time is literally relative around the world. Daylight savings, timezones etc. Not everyone&rsquo;s 5pm is the same 5pm, even every persons hour is not the same. In lots of situations if you set a cache to expire in 10 mins, then daylight savings happens the cache might not invalidate for an hour longer than you were expecting!</li><li><strong>Moving pieces are hard to track;</strong> Usually your system won&rsquo;t have one function being called. Lots of stuff happens at different times. Not every user is going to update their profile picture at your exact 10 min interval. This doesn&rsquo;t matter a lot of the time, but for something time sensitive (like concert tickets going on sale), this can cause issues.</li><li><strong>Crystal balls aren&rsquo;t very helpful;</strong> While lots of people are predictable, not every situation is. Let&rsquo;s say you have the time based pre-fetching system in place, and you&rsquo;re a movie streaming service. But then the global launch of a popular movie is at 3am in a country. You will end up with a massive load of traffic from that country at a time you weren&rsquo;t expecting, and your caches won&rsquo;t help you.</li></ul><p>All of these problems are present in the above example. There will actually be several bugs if you use the code provided. In python you can use timezone packages like <a href=https://pypi.org/project/pytz/>pytz</a> to avoid some of the problems, and in javascript <a href=https://github.com/spencermountain/spacetime>spacetime</a> has similar functionality.</p><h3 id=updatepush-based>Update/Push-based</h3><p>This method is essentially updating the cache when there is new data. This means you essentially &ldquo;subscribe&rdquo; to any changes. Here might be an example:</p><p><code>js</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Map</span>(); <span style=color:#75715e>// Store results of user queries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updateUser</span>(<span style=color:#a6e22e>user_id</span>, <span style=color:#a6e22e>data</span>){
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Connect and get database object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>connect</span>() 
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Store data in DB
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>store</span>(<span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#a6e22e>user_id</span>, <span style=color:#a6e22e>data</span>) 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>userID</span>)){ <span style=color:#75715e>// Exists in cache
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// Update cache
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>userID</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUser</span>(<span style=color:#a6e22e>userID</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>userID</span>)){ <span style=color:#75715e>// New ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// Connect and get database object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>connect</span>(); 
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Query for user
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#a6e22e>userID</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Store data for next time
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>userID</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>userID</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>python</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>users <span style=color:#f92672>=</span> dict() <span style=color:#75715e># Store results of user queries</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>update_user</span>(user_id: int, data: dict):
</span></span><span style=display:flex><span>    <span style=color:#75715e># Connect and get database object</span>
</span></span><span style=display:flex><span>    db <span style=color:#f92672>=</span> database<span style=color:#f92672>.</span>connect() 
</span></span><span style=display:flex><span>    <span style=color:#75715e># Store data in DB</span>
</span></span><span style=display:flex><span>    db<span style=color:#f92672>.</span>store(<span style=color:#e6db74>&#34;user&#34;</span>, user_id, data) 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Update cache</span>
</span></span><span style=display:flex><span>    user_data <span style=color:#f92672>=</span> users<span style=color:#f92672>.</span>get(user_id, <span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> user_data: <span style=color:#75715e># Exists in cache</span>
</span></span><span style=display:flex><span>        users[user_id] <span style=color:#f92672>=</span> data 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_user</span>(user_id: int):
</span></span><span style=display:flex><span>    user_data <span style=color:#f92672>=</span> users<span style=color:#f92672>.</span>get(user_id, <span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> user_data: <span style=color:#75715e># New user ID</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Connect and get database object</span>
</span></span><span style=display:flex><span>        db <span style=color:#f92672>=</span> database<span style=color:#f92672>.</span>connect() 
</span></span><span style=display:flex><span>        <span style=color:#75715e># Query for user</span>
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> db<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;user&#34;</span>, user_id)
</span></span><span style=display:flex><span>        <span style=color:#75715e># Store for next time</span>
</span></span><span style=display:flex><span>        users[user_id] <span style=color:#f92672>=</span> data 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> data
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> user_data
</span></span></code></pre></div><h3 id=event-based>Event based</h3><p>Sometimes changes happen on very regular schedules. For these sorts of changes you can have the cache invalidation happen only after a threshold event. For example you only have to update a cached list of results of games in a soccer tournament <strong>after each game</strong>. So you can have the cache be updated when the game has officially been ended and called by the referee.</p></div><div class="card text-center"><div class=share-icons><h2>Share the article</h2><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fschulichignite.com%2fblog%2fits-caches-all-the-way-down%2f" target=_blank><i class="bi bi-facebook"></i></a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fschulichignite.com%2fblog%2fits-caches-all-the-way-down%2f" target=_blank><i class="bi bi-linkedin"></i></a>
<a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20post%20from%20schulich%20ignite%3A%0Ahttps%3a%2f%2fschulichignite.com%2fblog%2fits-caches-all-the-way-down%2f" target=_blank><i class="bi bi-twitter"></i></a></div><a href=../../blog/index.xml target=_blank class=p-3>or subscribe to the blog with RSS <i class="bi bi-rss-fill"></i></a></div></div></div></div></div></section></body><footer class="footer sticky-bottom" style=position:fixed;background-color:#ffcdae><div class=container><div class=row><a href=https://www.instagram.com/schulichignite target=_blank rel="noopener noreferrer"><i class="bi bi-instagram is-large"></i></a>
<a href=https://www.youtube.com/channel/UC7tNvdbu952HOUl_4nK7iww target=_blank rel="noopener noreferrer"><i class="bi bi-youtube is-large"></i></a>
<a href=https://vm.tiktok.com/ZSHPbWU3/ target=_blank rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentcolor" class="bi bi-tiktok is-large mt-3" viewBox="0 0 16 16"><path d="M9 0h1.98c.144.715.54 1.617 1.235 2.512C12.895 3.389 13.797 4 15 4v2c-1.753.0-3.07-.814-4-1.829V11A5 5 0 116 6v2a3 3 0 103 3V0z"/></svg></a><a href=https://www.facebook.com/SchulichIgnite/ target=_blank rel="noopener noreferrer"><i class="bi bi-facebook is-large"></i></a>
<a href=https://linkedin.com/company/schulich-ignite/ target=_blank rel="noopener noreferrer"><i class="bi bi-linkedin is-large"></i></a>
<a href=https://discord.gg/F3Qjqqj target=_blank rel="noopener noreferrer"><i class="bi bi-discord is-large"></i></a></div></div></footer><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js integrity=sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js integrity="sha512-bgHRAiTjGrzHzLyKOnpFvaEpGzJet3z4tZnXGjpsCcqOnAH6VGUx9frc5bcIhKTVLEiCO6vEhNAgx5jtLUYrfA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/django.min.js integrity="sha512-1NHUMVlHsFnOe0Q36JMbBrNrjVcMdue2occC2xHWYXo7epa3YR54ZibI1G4I+tnJKBGNib11d8JzOElMfUSpYg==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/http.min.js integrity="sha512-4Rcwpn+xUuCDufCycA9UtpmboCxNHysWy23e45PJBQeh7m6Kno5/oQ4T5SmbmSAAZiDsm/IsX1IJwsOjy6ob0g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/http.min.js integrity="sha512-4Rcwpn+xUuCDufCycA9UtpmboCxNHysWy23e45PJBQeh7m6Kno5/oQ4T5SmbmSAAZiDsm/IsX1IJwsOjy6ob0g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>hljs.addPlugin(new CopyButtonPlugin),hljs.highlightAll(),hljs.initLineNumbersOnLoad()</script><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.esm.min.mjs';
    
    let mermaidConfig = {
    startOnLoad: true,
    "theme": "base",
        "themeVariables": {
            "primaryColor": "#ffde59",
            "primaryTextColor": "#d14b3b",
            "primaryBorderColor": "#7C0000",
            "lineColor": "#F8B229",
            "secondaryColor": "#fff",
            "tertiaryColor": "#d14b3b"
        }
    }
    mermaid.initialize(mermaidConfig, '.language-mermaid');
</script><script>window.onload=()=>{words={},articleContent=document.getElementById("article-content").innerHTML,contentSections=articleContent.match(/<p>(.*?)<\/p>|<ul>(.*?)<\/ul>|<ol>(.*?)<\/ol>/g),contentSections.forEach(e=>{for(word in words)searchMask=` ${word} |^${word} |${word}$| ${word}$|${word},`,regEx=new RegExp(searchMask,"igm"),newval=`${e}`.replace(regEx,` <a href="${words[word][0]}" target="_blank" data-toggle="tooltip" data-placement="top" title="${words[word][1]}">${word}</a> `),document.getElementById("article-content").innerHTML=document.getElementById("article-content").innerHTML.replace(e,newval)}),$(function(){$('[data-toggle="tooltip"]').tooltip()})}</script></html>