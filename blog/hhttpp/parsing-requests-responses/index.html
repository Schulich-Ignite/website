<!doctype html><html style=overflow-x:hidden><head><meta charset=utf-8><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","author":"Schulich Ignite","name":"HHTTPPP Post 2","dateCreated":"2023-99-06","text":"Now that we have our basic HTTP structure we need a way to read actual http requests\/responses. Currently we have hardcoded everything, so today we will focus on creating everything we need for steps 2-4:","image":"\/img\/blog\/hhttpp\/hero.jpg"}</script><title>HHTTPPP Post 2 | Schulich Ignite</title><link rel="shortcut icon" href=https://schulichignite.com/img/favicon.ico type=image/x-icon><link rel=icon href=https://schulichignite.com/img/favicon.ico type=image/x-icon><meta property="og:title" content=" HHTTPPP Post 2 | Schulich Ignite Blog "><meta property="og:type" content="website"><meta property="og:url" content=" https://schulichignite.com/blog/hhttpp/parsing-requests-responses/ "><meta property="og:image" content="/img/blog/hhttpp/hero.jpg "><meta name=Description content=" HHTTPPP Post 2; Now that we have our basic HTTP structure we need a way to read actual http requests/responses. Currently we have hardcoded everything, so today we will focus on creating everything we need for steps 2-4: "><meta property="og:description" content=" HHTTPPP Post 2; Now that we have our basic HTTP structure we need a way to read actual http requests/responses. Currently we have hardcoded everything, so today we will focus on creating everything we need for steps 2-4: "><link href="https://fonts.googleapis.com/css2?family=Raleway:wght@900&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Encode+Sans+Semi+Condensed:wght@900&display=swap" rel=stylesheet><link href=https://unpkg.com/video.js@7/dist/video-js.min.css rel=stylesheet><link href=https://unpkg.com/@videojs/themes@1/dist/sea/index.css rel=stylesheet><link rel=stylesheet href=https://schulichignite.com/css/index.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/vs2015.min.css integrity="sha512-mtXspRdOWHCYp+f4c7CkWGYPPRAhq9X+xCvJMUBVAb6pqA4U8pxhT3RWT3LP3bKbiolYL2CkL1bSKZZO4eeTew==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css></head><nav class="navbar sticky-top navbar-expand-lg navbar-dark bg-dark"><a class=navbar-brand href=../../../><img src=https://schulichignite.com/img/logos/ignite.svg width=40 height=60 alt="Schulich ignite logo">
<span class=brand-name>Schulich Ignite</span></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Sessions</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=../../../beginner>Ignite Beginner</a>
<a class=dropdown-item href=../../../flare>Ignite Flare</a>
<a class=dropdown-item href=../../../scorch>Ignite Scorch</a></div></li></li><li class=nav-item><a class=nav-link href=https://forms.gle/ZJoDAbcTf1M3NBxYA target=_blank rel="noopener noreferrer">Mailing list</a></li><li class=nav-item><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Media</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=../../../blog>Blog</a>
<a class=dropdown-item href=../../../definitions>Definitions</a></div></li></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>About</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=../../../mission>Our Mission</a>
<a class=dropdown-item href=../../../team>Our Team</a></li><li class=nav-item><a class=nav-link href=../../../contact>Contact</a></li></ul></div></nav><body><div class=diagonal-header><div class=mainheader>Blog</div><div class="subheader dates d-none d-sm-block"><span class=long-dates>Monday, Sep 11, 2023</span>
<span class=short-dates>09/11/23</span></div></div><section class=section><img class="card-img-top large-image blog-hero-image" src=../../../img/blog/hhttpp/hero.jpg><div class=container><div class=row><div class="card no-background"><div class=card-body><h1 class=card-title>HHTTPPP Post 2</h1><h3 style=font-size:1em;color:#787878>Parsing HTTP requests and responses</h3><a class="btn btn-secondary my-2" href=../../../blog>&larr; Go back to blog</a><div id=article-info class=card><div class=row><div class=col-md-6><div class=card-body><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#terms--concepts>Terms & Concepts</a></li><li><a href=#what-is-regex>What is regex?</a><ul><li><a href=#why>Why?</a></li></ul></li><li><a href=#getting-file-lists>Getting file lists</a><ul><li><a href=#creating-urls-from-file-list>Creating URL&rsquo;s from file list</a></li></ul></li><li><a href=#matching-headers>Matching headers</a></li><li><a href=#parse-content>Parse content</a></li><li><a href=#parsing-requests>Parsing Requests</a><ul><li><a href=#parsing-first-line-of-request>Parsing first line of request</a></li></ul></li><li><a href=#parsing-responses>Parsing Responses</a><ul><li><a href=#check-first-line-of-response>Check first line of response</a></li></ul></li><li><a href=#more-resources>More resources</a></li></ul></nav></p></div></div><div class=col-md-6><div class=card-body><p class=card-text><i class="bi bi-calendar2-week-fill"></i> <time>Monday, Sep 11, 2023</time></p><p class=card-text><i class="bi bi-stopwatch-fill"></i><em>~9 Minute Read</em><br><em><i class="bi bi-tags-fill"></i></em>
<a href=https://schulichignite.com/tags/python/>python</a>,
<a href=https://schulichignite.com/tags/scorch/>scorch</a>,
<a href=https://schulichignite.com/tags/web/>web</a>,
<a href=https://schulichignite.com/tags/theory/>theory</a></p><h4>Author(s) information</h4><div id=author-information><a href=https://schulichignite.com/authors/kieran-wood/ target=_blank rel="noopener noreferrer"><img width=100rem src=../../../img/blog/avatars/kieran.jpg alt></a><h6 class=card-title><a href=https://schulichignite.com/authors/kieran-wood/ target=_blank rel="noopener noreferrer"><br>Kieran Wood</a></h6><div id=author-icons><a href=mailto:kieran@canadiancoding.ca><i class="bi bi-envelope-fill"></i></a>
<a href=https://github.com/descent098 target=_blank><i class="bi bi-github"></i></a>
<a href=https://linkedin.com/in/kieran-wood target=_blank><i class="bi bi-linkedin"></i></a>
<a href=https://kieranwood.ca target=_blank><i class="bi bi-globe"></i></a></div><div class=text-primary style=max-width:40ch><p>I&rsquo;m a computer science major, with a minor in philosophy. I love to do open source work, especially in scripting, automation, web development, API&rsquo;s, CLI&rsquo;s and dev ops!</p></div></div></div></div></div></div></div><hr><div id=article-content class="card-text blog-text"><p>Now that we have our basic HTTP structure we need a way to read <strong>actual</strong> http requests/responses. Currently we have hardcoded everything, so today we will focus on creating everything we need for steps 2-4:</p><ol><li>Recieve plaintext request</li><li><strong>Parse the plaintext into a <code>Request</code> object</strong></li><li><strong>Process the <code>Request</code> object and generate a <code>Reponse</code> object</strong></li><li><strong>Generate a plaintext response from the <code>Response</code> object</strong></li></ol><h2 id=terms--concepts>Terms & Concepts</h2><p>To start there are some terms we need to understand. Here&rsquo;s what we need to know about, and what we&rsquo;re going to cover in more detail later.</p><table><thead><tr><th>Term</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td>Parser</td><td>A piece of code that can read data in one format (usually plain text) and parse them into another format (object, different text format etc.)</td><td>A fast <a href=https://github.com/MagicStack/httptools>HTTP parser</a> in python (also anything that works with HTTP will have some sort of parser)</td></tr><tr><td>Data Sanitization</td><td>Removing parts of an input that might cause undesirable behaviour</td><td>Cleaning text that comes in from a comment that could be interpreted as HTML so it doesn&rsquo;t render as HTML when people visit the comments later</td></tr></tbody></table><h2 id=what-is-regex>What is regex?</h2><p>Regex is a pattern matching language. It let&rsquo;s you define patterns of text that it will then return the matches for. So if you wanted to extract all the numbers from some text you can define a regex pattern. The patterns are called regex expressions, and are just plain text. For example all of the below are regex patterns:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#e6db74>&#34;[A-z]&#34;</span> <span style=color:#75715e># Match any single uppercase or lowercase character</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;[a-z]&#34;</span> <span style=color:#75715e># Match any single lowercase character</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;[aef]&#34;</span> <span style=color:#75715e># Match any single a, e or f</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;\d&#34;</span> <span style=color:#75715e># Match any single digit (0-9)</span>
</span></span></code></pre></div><p>Regex will usually parsed in python using the <a href=https://docs.python.org/3/library/re.html>re</a> module (but we will also use <a href=https://docs.python.org/3/library/glob.html>glob</a>), and will create <code>Match</code> objects. These <code>Match</code> objects contain each match for the pattern you define. There are lots of different ways to use regex, but we will use 2 ways, globbing and capture groups.</p><p>Capture groups is essentially the idea that we define a set of &ldquo;groups&rdquo;, and for each <code>Match</code> in the pattern there will be &ldquo;groups&rdquo; of text matched. For example we might read the first line of a HTTP request we will want different groups for the method, slug and http version. To create groups you put a sub-expression into parenthesis. For example to capture a single letter, and a single digit into separate groups you do <code>([A-z])(\d)</code>. This will find any letter then digit, so for example with the string <code>"a1,b5,dt,r7"</code> would have 3 matches <code>a1, b5 and r7</code> each with 2 groups:</p><ul><li><code>a1</code>: Group 1 is <code>a</code>, group 2 is <code>1</code></li><li><code>b5</code>: Group 1 is <code>b</code>, group 2 is <code>5</code></li><li><code>r7</code>: Group 1 is <code>r</code>, group 2 is <code>7</code></li></ul><p>We will cover globbing in the next section, it is a bit easier to do and is used to get a list of files.There is not enough time to cover regex fully, but for each set of regex we will use there will be an image explaining each portion of the expression. You can check the <a href=#more-resources>more resources</a> section for a general introduction to regex thatgoes into more details.</p><h3 id=why>Why?</h3><p>Regex is great for more complex patterns you need to locate. There are a few cases, but I want to give a comparisson to an alternative first. Iterative searching is where you go line-by-line and create some code that looks for your pattern manually. For example below we have the iterative code for collecting just the words that come before &ldquo;apple&rdquo; in a sentence</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>test_input <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;blah blah apple blah blah
</span></span></span><span style=display:flex><span><span style=color:#e6db74>blah, blah blah blah apple apple
</span></span></span><span style=display:flex><span><span style=color:#e6db74>blah apple
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apple
</span></span></span><span style=display:flex><span><span style=color:#e6db74>blah blah blah blah
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_words_before_apple</span>(text:str) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> test_input<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;apple&#34;</span> <span style=color:#f92672>in</span> line:
</span></span><span style=display:flex><span>            start <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>index(<span style=color:#e6db74>&#34;apple&#34;</span>)
</span></span><span style=display:flex><span>            result<span style=color:#f92672>.</span>append(line[:start:]) <span style=color:#75715e># Cutt off at start of apple</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            result<span style=color:#f92672>.</span>append(line)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>join(result)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_words_before_apple(test_input)
</span></span></code></pre></div><p>2 points about this code:</p><ol><li>There are a ton of whitespace bugs, along with other logical errors</li><li>A regular expression would be much smaller, and likely easier to understand (<code>^(.*)apple.*</code>)</li></ol><p>That being said keep in mind that pattern matching in general is not always super simple, and most of the code, and regex you see initially had bugs when I wrote it. Any pattern matching is a great time to write tests, because trying to find ways to break your patterns leads you to improving them!</p><p><strong>Regex</strong></p><table><thead><tr><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td>Universal accross languages</td><td>Used in tons of applications beyond just in programming languages (file+folder organization, searching etc.)</td></tr><tr><td>Syntax stays the same, so other people can help debug if they&rsquo;re familiar with it</td><td>large learning curve initially</td></tr><tr><td>It is often faster than the iterative approach because the language will optimize the module/package for regex</td><td>The more clever the pattern, usually the more difficult it is to understand</td></tr><tr><td>There are tons of tools to help you write regex</td><td>You often need tools to understand a regex pattern</td></tr></tbody></table><p><em>When to use</em></p><p>You can use regex whenever, but the ideal situation is when you have complex patterns that would take a lot of effort to implement with itterative approaches. For example only the uppercase letters that occur between the worlds apple and strawberry <code>^.*apple(.*)strawberry.*$</code>.</p><p>Additionally it can be used for more than just pattern matching in programs, regex can be a useful skill to learn for:</p><ul><li>Searching with <a href=https://www.gnu.org/software/grep/manual/grep.html>grep</a></li><li>Organizing files + folders</li><li>Searching & replacing in text editing applications (like <a href="https://learn.microsoft.com/en-us/visualstudio/ide/using-regular-expressions-in-visual-studio?view=vs-2022">vs code</a>)</li></ul><p><strong>Iterative Approach</strong></p><table><thead><tr><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td>No special pattern-matching language knowledge required</td><td>Often slower than regex because regex modules are often highly optimized</td></tr><tr><td>For super simple patterns it&rsquo;s often easier to reason about</td><td>Complex patterns become very hard to reason about often</td></tr></tbody></table><p>This works fine in python, but in lots of other languages you tend to itterate <strong>per letter</strong>. Regardless of which you choose to go with in your code I will cover options for both in the rest of the article.</p><h2 id=getting-file-lists>Getting file lists</h2><p>There are two more attributes we have added to the <code>Server</code> class, <code>file_list</code> and <code>urls</code>. <code>file_list</code> is a list of all the paths of files in <code>Server.proxy_directory</code>, and URL&rsquo;s are going to be the URL&rsquo;s that correspond to each file. The code for this can be found in <code>Server.__post_init__()</code>, and in this section we will describe how we generate <code>Server.file_list</code>.</p><p>We are going to use the <a href=https://docs.python.org/3/library/glob.html>glob</a> module to get a list of files. This lets us define patterns similar to regex, but it&rsquo;s specifically built for files. Since this is less applicable the basics are that <code>*</code> means replace with anything. So in our case to get every single file in a folder we can do <code>glob.glob("*.*")</code>. This is great, but what about if we have subdirectories (i.e. <code>/js/file.js</code>)? Now we need a fancier pattern.</p><p>The easiest way to do this is following the pattern <code>&lt;folder>/**/*</code>, this says all files in all folders. We then pass the recursive flag and it will find everything <code>glob.glob("&lt;folder>/**/*, recursive=True)</code>. For performance reasons we are going to use <code>glob.iglob()</code> (works the same), and we will replace <code>&lt;folder></code> with the absolute path to the proxy_directory we set on our server object.</p><p>Putting it all together here is the basic idea:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Server</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span> <span style=color:#75715e># More code</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__post_init__</span>(self):
</span></span><span style=display:flex><span>        proxy_dir <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>abspath(self<span style=color:#f92672>.</span>proxy_directory) <span style=color:#75715e># Making path absolute makes this easier</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> file <span style=color:#f92672>in</span> glob<span style=color:#f92672>.</span>iglob(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(proxy_dir, <span style=color:#e6db74>&#39;**&#39;</span>,<span style=color:#e6db74>&#34;*.*&#34;</span>), recursive<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>):
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>file_list<span style=color:#f92672>.</span>append(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(proxy_dir, file))
</span></span></code></pre></div><p>In the actual code I did the second part with a list comprehension:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Server</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span> <span style=color:#75715e># More code</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__post_init__</span>(self):
</span></span><span style=display:flex><span>        proxy_dir <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>abspath(self<span style=color:#f92672>.</span>proxy_directory)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>file_list <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(proxy_dir, file)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> file <span style=color:#f92672>in</span> glob<span style=color:#f92672>.</span>iglob(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(proxy_dir, <span style=color:#e6db74>&#39;**&#39;</span>,<span style=color:#e6db74>&#34;*.*&#34;</span>), recursive<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>        ]
</span></span></code></pre></div><h3 id=creating-urls-from-file-list>Creating URL&rsquo;s from file list</h3><p>Now that we have the files, we want to make sure that we can match URL&rsquo;s when they come in. For example if we recieve a GET request with <code>/about</code> as the slug we need to know what file to grab. In our case the only two extra rules we will have are:</p><ul><li>That HTML files will get their regular filenames, and their file with no extensions as valid URL&rsquo;s. For example <code>/about</code> and <code>/about.html</code> will point to the same file. To do this we need a dictionary mapping of these URL&rsquo;s to the files to be able to find it.</li><li><code>/</code> is an alias for <code>index.html</code> (<a href="https://dpericich.medium.com/why-do-we-use-index-html-files-71cf1973e10#:~:text=The%20index%20is%20the%20root,specific%20location%20on%20the%20server.">this is just the norm in webdev</a>)</li></ul><p>So for example some simplified code might look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>proxy_directory <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/site&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>files <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;/site/about.html&#34;</span>, <span style=color:#e6db74>&#34;/site/js/main.js&#34;</span>, <span style=color:#e6db74>&#34;/site/index.html&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>urls <span style=color:#f92672>=</span> dict()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> file <span style=color:#f92672>in</span> files:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> file<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#34;index.html&#34;</span>): <span style=color:#75715e># Homepage</span>
</span></span><span style=display:flex><span>        urls[<span style=color:#e6db74>&#34;/&#34;</span>] <span style=color:#f92672>=</span> file
</span></span><span style=display:flex><span>        urls[<span style=color:#e6db74>&#34;/index.html&#34;</span>] <span style=color:#f92672>=</span> file
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> file<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#34;.html&#34;</span>): <span style=color:#75715e># HTML files</span>
</span></span><span style=display:flex><span>        urls[file<span style=color:#f92672>.</span>replace(proxy_directory, <span style=color:#e6db74>&#34;&#34;</span>)] <span style=color:#f92672>=</span> file <span style=color:#75715e># filename (i.e. /about.html)</span>
</span></span><span style=display:flex><span>        urls[file<span style=color:#f92672>.</span>replace(proxy_directory, <span style=color:#e6db74>&#34;&#34;</span>)[:<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>:]] <span style=color:#f92672>=</span> file <span style=color:#75715e># remove extension (i.e. /about)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>: <span style=color:#75715e># Non-html files</span>
</span></span><span style=display:flex><span>        urls[file<span style=color:#f92672>.</span>replace(proxy_directory, <span style=color:#e6db74>&#34;&#34;</span>)] <span style=color:#f92672>=</span> file
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(urls) <span style=color:#75715e># {&#39;/about.html&#39;: &#39;/site/about.html&#39;, &#39;/about&#39;: &#39;/site/about.html&#39;, &#39;/js/main.js&#39;: &#39;/site/js/main.js&#39;, &#39;/&#39;: &#39;/site/index.html&#39;, &#39;/index.html&#39;: &#39;/site/index.html&#39;}</span>
</span></span></code></pre></div><p>The actual implementation can be found in <code>Server.__post_init__()</code>.</p><h2 id=matching-headers>Matching headers</h2><p>Our first task is to create a pattern to match headers, this will be important for requests and responses, here is the regex for doing this:</p><p><img src=../../../img/blog/hhttpp/Post%202/regex-http-headers.png alt></p><p><a href=https://regex101.com/r/9IHYxj/2>Link to regex101</a></p><p>So essentially for each match group 1 is the header name, and group 2 is the header value. We can then assign that into a dictionary using group 1 as the key, and group 2 as the value. You can do this with normal strings in python like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>response <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;HTTP/1.1 200 OK
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Content-Type: text/html; charset=utf-8
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Server: hhttpp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;!DOCTYPE HTML&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;html&gt;&lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;h1&gt;Hello, World!&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/body&gt;&lt;/html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Convert response to list of each line and skip the first line</span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)[<span style=color:#ae81ff>1</span>::]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>headers <span style=color:#f92672>=</span> dict()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> response:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> line: <span style=color:#75715e># Empty line means content starts</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span> <span style=color:#75715e># end loop</span>
</span></span><span style=display:flex><span>    line <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;:&#34;</span>)
</span></span><span style=display:flex><span>    headers[line[<span style=color:#ae81ff>0</span>]] <span style=color:#f92672>=</span> line[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(headers) <span style=color:#75715e># {&#39;Content-Type&#39;: &#39; text/html; charset=utf-8&#39;, &#39;Server&#39;: &#39; hhttpp&#39;}</span>
</span></span></code></pre></div><p>But keep in mind this iterative approach can have bugs if someone sends a header to the server that is malformed.</p><h2 id=parse-content>Parse content</h2><p>For requests and responses we will need the content if it&rsquo;s there. Luckily this is pretty easy. Content comes after headers and <strong>must</strong> have at least 1 empty line between the headers and content.</p><p>With this one we will need a flag. A flag lets you change the functionality of regex, in our case we must set the <code>/s</code> flag, which will allow us to select multiple lines of content. Here is the regex that works to get this content:</p><p><img src=../../../img/blog/hhttpp/Post%202/regex-http-response-content.png alt></p><p><a href=https://regex101.com/r/YDue2M/1>Link to regex101</a></p><p>You can do this with normal strings in python like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>response <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;HTTP/1.1 200 OK
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Content-Type: text/html; charset=utf-8
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Server: hhttpp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;!DOCTYPE HTML&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;html&gt;&lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;h1&gt;Hello, World!&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/body&gt;&lt;/html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Convert response to list of each line and skip the first line</span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)[<span style=color:#ae81ff>1</span>::]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> index, line <span style=color:#f92672>in</span> enumerate(response):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> line: <span style=color:#75715e># Empty line means content starts</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Recreate HTML joining each line with a newline at the end</span>
</span></span><span style=display:flex><span>        content <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>join(response[index<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>::])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span> <span style=color:#75715e># end loop</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(content)
</span></span></code></pre></div><h2 id=parsing-requests>Parsing Requests</h2><p>The main thing we will have to deal with is parsing a request and generating responses. So let&rsquo;s look at how we will do this.</p><h3 id=parsing-first-line-of-request>Parsing first line of request</h3><p>The first line of a request is incredibly important, it contains information about the method used, the slug and the HTTP version. So we need a regex pattern to capture all this information:</p><p><img src=../../../img/blog/hhttpp/Post%202/regex-first-line-of-http-request.png alt></p><p><a href=https://regex101.com/r/5UF0Re/1>Link to regex 101</a></p><p>You can do this with normal strings in python like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>request <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;GET /img/low-poly-ice-caps.jpg HTTP/1.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Content-Type: text/html; charset=utf-8
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Server: hhttpp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;!DOCTYPE HTML&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;h1&gt;Hello, World!&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Convert response to list of each line</span>
</span></span><span style=display:flex><span>request <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Split the first line by spaces, and assign to variables</span>
</span></span><span style=display:flex><span>method, slug, version <span style=color:#f92672>=</span> request[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; &#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Convert values to different types (this will throw errors if mistakes are made in the response)</span>
</span></span><span style=display:flex><span>version <span style=color:#f92672>=</span> float(version<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;HTTP/&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>method<span style=color:#e6db74>=}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{</span>slug<span style=color:#e6db74>=}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{</span>version<span style=color:#e6db74>=}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h2 id=parsing-responses>Parsing Responses</h2><p>Now that we can parse headers, content, and requests, let&rsquo;s look at how we should interpret responses. This won&rsquo;t really matter for our features, but it will be handy for testing later.</p><h3 id=check-first-line-of-response>Check first line of response</h3><p>The first line of the response will have details about a response. As I mentioned this has no purpose in our code, but here is what you would need to do it:</p><p><img src=../../../img/blog/hhttpp/Post%202/regex-first-line-of-http-response.png alt></p><p><a href=https://regex101.com/r/707uYq/1>Link to regex101</a></p><p>You can do this with normal strings in python like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>response <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;HTTP/1.1 200 OK
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Content-Type: text/html; charset=utf-8
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Server: hhttpp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;!DOCTYPE HTML&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;html&gt;&lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;h1&gt;Hello, World!&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/body&gt;&lt;/html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Convert response to list of each line</span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Split the first line by spaces, and assign to variables</span>
</span></span><span style=display:flex><span>header_version, status_code, response_description <span style=color:#f92672>=</span> response[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; &#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Convert values to different types (this will throw errors if mistakes are made in the response)</span>
</span></span><span style=display:flex><span>header_version <span style=color:#f92672>=</span> float(header_version<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;/&#34;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>status_code <span style=color:#f92672>=</span> int(status_code)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>header_version<span style=color:#e6db74>=}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{</span>status_code<span style=color:#e6db74>=}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{</span>response_description<span style=color:#e6db74>=}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h2 id=more-resources>More resources</h2><ul><li><a href=https://regexone.com/lesson/introduction_abcs>Interactive introduction to regex</a></li><li><a href=https://regex101.com/>regex 101; Great tool for writing regex</a></li><li><a href=https://regexper.com/>Regexper; online visualizer for regex</a></li><li><a href=https://www.debuggex.com/>debuggex; An online debugger for regex</a></li></ul></div><div class="card text-center"><div class=share-icons><h2>Share the article</h2><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fschulichignite.com%2fblog%2fhhttpp%2fparsing-requests-responses%2f" target=_blank><i class="bi bi-facebook"></i></a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fschulichignite.com%2fblog%2fhhttpp%2fparsing-requests-responses%2f" target=_blank><i class="bi bi-linkedin"></i></a>
<a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20post%20from%20schulich%20ignite%3A%0Ahttps%3a%2f%2fschulichignite.com%2fblog%2fhhttpp%2fparsing-requests-responses%2f" target=_blank><i class="bi bi-twitter"></i></a></div><a href=../../../blog/index.xml target=_blank class=p-3>or subscribe to the blog with RSS <i class="bi bi-rss-fill"></i></a></div></div></div></div></div></section></body><footer class="footer sticky-bottom" style=position:fixed;background-color:#ffcdae><div class=container><div class=row><a href=https://www.instagram.com/schulichignite target=_blank rel="noopener noreferrer"><i class="bi bi-instagram is-large"></i></a>
<a href=https://www.youtube.com/channel/UC7tNvdbu952HOUl_4nK7iww target=_blank rel="noopener noreferrer"><i class="bi bi-youtube is-large"></i></a>
<a href=https://vm.tiktok.com/ZSHPbWU3/ target=_blank rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentcolor" class="bi bi-tiktok is-large mt-3" viewBox="0 0 16 16"><path d="M9 0h1.98c.144.715.54 1.617 1.235 2.512C12.895 3.389 13.797 4 15 4v2c-1.753.0-3.07-.814-4-1.829V11A5 5 0 116 6v2a3 3 0 103 3V0z"/></svg></a><a href=https://www.facebook.com/SchulichIgnite/ target=_blank rel="noopener noreferrer"><i class="bi bi-facebook is-large"></i></a>
<a href=https://linkedin.com/company/schulich-ignite/ target=_blank rel="noopener noreferrer"><i class="bi bi-linkedin is-large"></i></a>
<a href=https://discord.gg/F3Qjqqj target=_blank rel="noopener noreferrer"><i class="bi bi-discord is-large"></i></a></div></div></footer><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js integrity=sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js integrity="sha512-bgHRAiTjGrzHzLyKOnpFvaEpGzJet3z4tZnXGjpsCcqOnAH6VGUx9frc5bcIhKTVLEiCO6vEhNAgx5jtLUYrfA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/django.min.js integrity="sha512-1NHUMVlHsFnOe0Q36JMbBrNrjVcMdue2occC2xHWYXo7epa3YR54ZibI1G4I+tnJKBGNib11d8JzOElMfUSpYg==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/http.min.js integrity="sha512-4Rcwpn+xUuCDufCycA9UtpmboCxNHysWy23e45PJBQeh7m6Kno5/oQ4T5SmbmSAAZiDsm/IsX1IJwsOjy6ob0g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/http.min.js integrity="sha512-4Rcwpn+xUuCDufCycA9UtpmboCxNHysWy23e45PJBQeh7m6Kno5/oQ4T5SmbmSAAZiDsm/IsX1IJwsOjy6ob0g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>hljs.addPlugin(new CopyButtonPlugin),hljs.highlightAll(),hljs.initLineNumbersOnLoad()</script><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.esm.min.mjs';
    
    let mermaidConfig = {
    startOnLoad: true,
    "theme": "base",
        "themeVariables": {
            "primaryColor": "#ffde59",
            "primaryTextColor": "#d14b3b",
            "primaryBorderColor": "#7C0000",
            "lineColor": "#F8B229",
            "secondaryColor": "#fff",
            "tertiaryColor": "#d14b3b"
        }
    }
    mermaid.initialize(mermaidConfig, '.language-mermaid');
</script><script>window.onload=()=>{words={},articleContent=document.getElementById("article-content").innerHTML,contentSections=articleContent.match(/<p>(.*?)<\/p>|<ul>(.*?)<\/ul>|<ol>(.*?)<\/ol>/g),contentSections.forEach(e=>{for(word in words)searchMask=` ${word} |^${word} |${word}$| ${word}$|${word},`,regEx=new RegExp(searchMask,"igm"),newval=`${e}`.replace(regEx,` <a href="${words[word][0]}" target="_blank" data-toggle="tooltip" data-placement="top" title="${words[word][1]}">${word}</a> `),document.getElementById("article-content").innerHTML=document.getElementById("article-content").innerHTML.replace(e,newval)}),$(function(){$('[data-toggle="tooltip"]').tooltip()})}</script></html>