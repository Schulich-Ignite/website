<!doctype html><html style=overflow-x:hidden><head><meta charset=utf-8><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","author":"Schulich Ignite","name":"HHTTPPP; Implementing the networking portion","dateCreated":"2023-99-06","text":"We have what we need to make HTTP requests and responses properly, so now let\u0026rsquo;s look at adding networking so we can see the results in the browser.","image":"\/img\/blog\/hhttpp\/hero.jpg"}</script><title>HHTTPPP; Implementing the networking portion | Schulich Ignite</title><link rel="shortcut icon" href=https://schulichignite.com/img/favicon.ico type=image/x-icon><link rel=icon href=https://schulichignite.com/img/favicon.ico type=image/x-icon><meta property="og:title" content=" HHTTPPP; Implementing the networking portion | Schulich Ignite Blog "><meta property="og:type" content="website"><meta property="og:url" content=" https://schulichignite.com/blog/hhttpp/implementing-the-networking-portion/ "><meta property="og:image" content="/img/blog/hhttpp/hero.jpg "><meta name=Description content=" HHTTPPP; Implementing the networking portion; We have what we need to make HTTP requests and responses properly, so now let&rsquo;s look at adding networking so we can see the results in the browser. "><meta property="og:description" content=" HHTTPPP; Implementing the networking portion; We have what we need to make HTTP requests and responses properly, so now let&rsquo;s look at adding networking so we can see the results in the browser. "><link href="https://fonts.googleapis.com/css2?family=Raleway:wght@900&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Encode+Sans+Semi+Condensed:wght@900&display=swap" rel=stylesheet><link href=https://unpkg.com/video.js@7/dist/video-js.min.css rel=stylesheet><link href=https://unpkg.com/@videojs/themes@1/dist/sea/index.css rel=stylesheet><link rel=stylesheet href=https://schulichignite.com/css/index.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/vs2015.min.css integrity="sha512-mtXspRdOWHCYp+f4c7CkWGYPPRAhq9X+xCvJMUBVAb6pqA4U8pxhT3RWT3LP3bKbiolYL2CkL1bSKZZO4eeTew==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css></head><nav class="navbar sticky-top navbar-expand-lg navbar-dark bg-dark"><a class=navbar-brand href=../../../><img src=https://schulichignite.com/img/logos/ignite.svg width=40 height=60 alt="Schulich ignite logo">
<span class=brand-name>Schulich Ignite</span></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Sessions</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=../../../beginner>Ignite Beginner</a>
<a class=dropdown-item href=../../../flare>Ignite Flare</a>
<a class=dropdown-item href=../../../scorch>Ignite Scorch</a></div></li></li><li class=nav-item><a class=nav-link href=https://forms.gle/ZJoDAbcTf1M3NBxYA target=_blank rel="noopener noreferrer">Mailing list</a></li><li class=nav-item><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Media</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=../../../blog>Blog</a>
<a class=dropdown-item href=../../../language>Languages</a>
<a class=dropdown-item href=../../../definitions>Definitions</a></div></li></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>About</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=../../../mission>Our Mission</a>
<a class=dropdown-item href=../../../team>Our Team</a></li><li class=nav-item><a class=nav-link href=../../../contact>Contact</a></li></ul></div></nav><body><div class=diagonal-header><div class=mainheader>Blog</div><div class="subheader dates d-none d-sm-block"><span class=long-dates>Monday, Sep 25, 2023</span>
<span class=short-dates>09/25/23</span></div></div><section class=section><img class="card-img-top large-image blog-hero-image" src=../../../img/blog/hhttpp/hero.jpg><div class=container><div class=row><div class="card no-background"><div class=card-body><h1 class=card-title>HHTTPPP; Implementing the networking portion</h1><h3 style=font-size:1em;color:#787878>How to use sockets to communicate over the internet</h3><a class="btn btn-secondary my-2" href=../../../blog>&larr; Go back to blog</a><div id=article-info class=card><div class=row><div class=col-md-6><div class=card-body><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#how-connections-work>How connections work</a></li><li><a href=#berkley-sockets>Berkley Sockets</a><ul><li><a href=#so-what-actually-are-berkley-sockets>So what actually are berkley sockets?</a></li></ul></li><li><a href=#how-to-use-them>How to use them</a><ul><li><a href=#how-this-works-in-python>How this works in python</a></li><li><a href=#common-gotchas>Common gotchas</a></li><li><a href=#binary-vs-text-data>Binary vs Text data</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#resources>Resources</a></li></ul></nav></p></div></div><div class=col-md-6><div class=card-body><p class=card-text><i class="bi bi-calendar2-week-fill"></i> <time>Monday, Sep 25, 2023</time></p><p class=card-text><i class="bi bi-stopwatch-fill"></i><em>~11 Minute Read</em><br><em><i class="bi bi-tags-fill"></i></em>
<a href=https://schulichignite.com/tags/python/>python</a>,
<a href=https://schulichignite.com/tags/scorch/>scorch</a>,
<a href=https://schulichignite.com/tags/web/>web</a>,
<a href=https://schulichignite.com/tags/theory/>theory</a></p><h4>Author(s) information</h4><div id=author-information><a href=https://schulichignite.com/authors/kieran-wood/ target=_blank rel="noopener noreferrer"><img width=100rem src=../../../img/blog/avatars/kieran.jpg alt></a><h6 class=card-title><a href=https://schulichignite.com/authors/kieran-wood/ target=_blank rel="noopener noreferrer"><br>Kieran Wood</a></h6><div id=author-icons><a href=mailto:kieran@canadiancoding.ca><i class="bi bi-envelope-fill"></i></a>
<a href=https://github.com/descent098 target=_blank><i class="bi bi-github"></i></a>
<a href=https://linkedin.com/in/kieran-wood target=_blank><i class="bi bi-linkedin"></i></a>
<a href=https://kieranwood.ca target=_blank><i class="bi bi-globe"></i></a></div><div class=text-primary style=max-width:40ch><p>I&rsquo;m a computer science major, with a minor in philosophy. I love to do open source work, especially in scripting, automation, web development, API&rsquo;s, CLI&rsquo;s and dev ops!</p></div></div></div></div></div></div></div><hr><div id=article-content class="card-text blog-text"><p>We have what we need to make HTTP requests and responses properly, so now let&rsquo;s look at adding networking so we can see the results in the browser. It&rsquo;s important to note we&rsquo;re only covering enough networking to understand <strong>this project</strong>, we&rsquo;re not covering everything there is to know about networking. So keep in mind there might be more steps and technologies in real server interactions!</p><p>Another warning is that for this set of code there is no easy way to test it without a ton of boilerplate code and concepts I would need to cover, and as such there are no additional tests for this post. If you want to know if your code works then open the URL to your server in a browser and see if it loads ¯\_(ツ)_/¯.</p><h2 id=how-connections-work>How connections work</h2><p>In previous posts we looked at a bunch of terms:</p><ul><li>Ip&rsquo;s and ports<ul><li>ipv4 vs ipv6</li><li>Localhost</li></ul></li><li>hostname/DNS</li><li>etc.</li></ul><p>For simplicity we will only care about a few terms:</p><ul><li>Ip&rsquo;s</li><li>Ports</li><li>Protocols</li><li>Berkley Sockets</li></ul><p>When we want to connect to another computer we can think about it the same way we would when we&rsquo;re sending a letter, or even an email. There&rsquo;s a few things we need:</p><ul><li>A message</li><li>A place to deliver the message</li><li>A place to get a response</li><li>A procedure to deliver the message</li></ul><p>Here is what the equivalent mail to http values would look like:</p><table><thead><tr><th>Role</th><th>HTTP</th><th>Mail</th></tr></thead><tbody><tr><td>A message</td><td>HTTP request</td><td>A letter or package</td></tr><tr><td>A place to deliver the message</td><td>The <strong>client</strong> IP address & port</td><td>An address</td></tr><tr><td>A place to get a response</td><td>The <strong>host</strong> IP address & port</td><td>An address</td></tr><tr><td>A procedure to deliver the message</td><td>HTTP over berkley sockets</td><td>The mail company rules through a post delivery person</td></tr></tbody></table><p>So for the postal service when you send a letter they will:</p><ol start=0><li>Drop off the letter at a post office to be sent</li><li>Lookup the address on the letter/package</li><li>Find the corresponding physical location on the letter/package</li><li>Drive to the location following rules and procedures of the company, and drop off the letter/package</li></ol><p>For retrieving a site they will:</p><ol start=0><li>If they used a domain they need to lookup the IP address associated with the domain</li><li>Start a connection with the IP address of the host through a berkley socket</li><li>Send an HTTP request through the socket</li><li>Wait for a response to be sent back from the server through the socket</li></ol><h2 id=berkley-sockets>Berkley Sockets</h2><p>*<em>We will cover the basics, but if you want a breakdown of sockets in detail (in python and in the underlying C calls python is making) check out <a href=https://gist.github.com/Descent098/783f68e1e3943e8796a3aaf8a14f8013>this gist</a>.</em></p><p>We&rsquo;ve now looked at how berkley/bsd sockets are used, but let&rsquo;s get into specifics. Our steps were:</p><ol start=0><li>If they used a domain they need to lookup the IP address associated with the domain</li><li>Start a connection with the IP address of the host through a berkley socket</li><li>Send an HTTP request through the socket</li><li>Wait for a response to be sent back from the server through the socket</li></ol><p>*<em>Keep in mind when you hear &ldquo;sockets&rdquo; in webdev it can mean berkley sockets, <strong>or</strong> <a href=https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API>websockets</a></em></p><h3 id=so-what-actually-are-berkley-sockets>So what actually are berkley sockets?</h3><p>Berkley/bsd Sockets are a fancy API provided by your operating system that allows you to talk to your NIC (network interface card). Your NIC is what sends the 1s and 0s over the internet, and berkley sockets are an API built on top of the hardware to make it easier to work with lower-level networking. They basically allow you to talk back and forth between you and your NIC in human-friendly ways. Under the hood each persons NIC running the code might be doing different things when you dig into the details, but berkley sockets are a universal standard for interfacing with NICs for basically any brand/card in your PC.</p><p>In our analogy from before Berkley Sockets would be the mail person delivering the mail. It&rsquo;s job is to simply connect to a computer and send/recieve data. It has no rules about what protocols you talk using, or anything like that. This means they can be used for more than HTTP (like <a href=https://en.wikipedia.org/wiki/Telnet>telnet</a> or <a href=https://www.ssh.com/academy/ssh/sftp-ssh-file-transfer-protocol>sftp</a>).</p><h2 id=how-to-use-them>How to use them</h2><p>There are 3 basic steps (and some sub-steps within them) to using berkley sockets as a server/host in your code:</p><ol><li>Setup/config: Tell the socket what you intend to do with it, so it can set itself up for what you need. This includes what type of IP address (<a href="https://bluecatnetworks.com/glossary/what-is-ipv4/#:~:text=Now%2C%20exactly%20what%20is%20IPv4%3F">IPV4</a> or <a href="https://en.wikipedia.org/wiki/IPv6_address#:~:text=An%20IPv6%20address%20is%20represented,the%20representation%20of%20IPv6%20addresses.">IPV6</a>), <a href=https://stackoverflow.com/questions/5815675/what-is-sock-dgram-and-sock-stream>socket type/kind</a>, and any <a href=https://www.gnu.org/software/libc/manual/html_node/Socket_002dLevel-Options.html#Socket_002dLevel-Options>options</a> you want to use.</li><li>Binding and listening: When you tell the socket what IP address and port to bind to, as well as when to start listening for connections<ol><li>Call <code>.bind()</code> with the host and port, this &ldquo;reserves&rdquo; the port so other sockets can&rsquo;t use them on the same IP address</li><li>Call <code>.listen()</code> to tell the socket to start listening for potential connections</li><li>Call <code>.accept()</code> to say you&rsquo;re fine with the incomming connection (any validation steps for only allowing certain devices would happen between <code>.listen()</code> and <code>.accept()</code>)</li></ol></li><li>Send/recv: This is when data is exchanged between the client and host</li></ol><h3 id=how-this-works-in-python>How this works in python</h3><p>In python you create a socket with a <a href=https://www.learndatasci.com/solutions/python-context-managers/>context manager</a>. What this does is basically for the duration of the program a socket will be opened, but you must make sure to close the socket or else that port is constantly being used and never released. A context manager makes sure that a socket is always closed once you&rsquo;re done with it.</p><p>Here is what steps 1 and 2 would look like in python:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> socket
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ip <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;127.0.0.1&#34;</span> <span style=color:#75715e># The IP address to use, this one specifies internal</span>
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> <span style=color:#ae81ff>8338</span> <span style=color:#75715e># The port to bind to</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> socket<span style=color:#f92672>.</span>socket(socket<span style=color:#f92672>.</span>AF_INET, socket<span style=color:#f92672>.</span>SOCK_STREAM) <span style=color:#66d9ef>as</span> s:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    s<span style=color:#f92672>.</span>setsockopt(socket<span style=color:#f92672>.</span>SOL_SOCKET, socket<span style=color:#f92672>.</span>SO_REUSEADDR, <span style=color:#ae81ff>1</span>) <span style=color:#75715e># Set internal socket to allow SO_REUSEADDR (1 means true)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Step 2</span>
</span></span><span style=display:flex><span>    s<span style=color:#f92672>.</span>bind((ip, port)) <span style=color:#75715e># Bind the configured socket to the server (assign ip address and port number to the socket instance)</span>
</span></span><span style=display:flex><span>    s<span style=color:#f92672>.</span>listen(<span style=color:#ae81ff>1</span>) <span style=color:#75715e># Listen for incoming connections</span>
</span></span><span style=display:flex><span>    client_connection, client_address <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>accept() <span style=color:#75715e># Accept connections and return details about them</span>
</span></span></code></pre></div><p>There&rsquo;s a few constants and variables we&rsquo;re using here so let&rsquo;s explain what they do</p><table><thead><tr><th>Constant/variable name</th><th>Purpose</th></tr></thead><tbody><tr><td><a href=https://docs.python.org/3/library/socket.html#socket.AF_INET>socket.AF_INET</a></td><td>This specifies you want to use an <a href="https://www.juniper.net/documentation/us/en/software/junos/interfaces-security-devices/topics/topic-map/security-interface-ipv4-ipv6-protocol.html#:~:text=Length%20Subnet%20Masks-,IPv4%20Classful%20Addressing,-To%20provide%20flexibility">ipv4</a> ip address instead of an <a href="https://en.wikipedia.org/wiki/IPv6_address#:~:text=An%20Internet%20Protocol%20Version%206,the%20destination%20of%20each%20packet.">ipv6</a> one</td></tr><tr><td><a href=https://docs.python.org/3/library/socket.html#socket.SOCK_STREAM>socket.SOCK_STREAM</a></td><td>This tells the socket to use <a href="https://www.fortinet.com/resources/cyberglossary/tcp-ip#:~:text=Transmission%20Control%20Protocol%20(TCP)%20is,data%20and%20messages%20over%20networks.">TCP</a> instead of <a href="https://www.cloudflare.com/learning/ddos/glossary/user-datagram-protocol-udp/#:~:text=The%20User%20Datagram%20Protocol%2C%20or,connection%20before%20data%20is%20transferred.">UDP</a>, this distinction is complicated, so don&rsquo;t worry about it for now, you will basically always use TCP unless you&rsquo;re in certain performance constrained situations but <a href="https://www.cloudflare.com/learning/ddos/glossary/user-datagram-protocol-udp/#:~:text=TCP%20vs.%20UDP,-UDP%20is%20faster">here is a quick breakdown</a></td></tr><tr><td><a href=https://www.gnu.org/software/libc/manual/html_node/Socket_002dLevel-Options.html#Socket_002dLevel-Options>socket.SOL_SOCKET</a></td><td>Allows you to set options for a socket (like SO_REUSEADDR below)</td></tr><tr><td><a href=https://www.gnu.org/software/libc/manual/html_node/Socket_002dLevel-Options.html#index-SO_005fREUSEADDR>socket.SO_REUSEADDR</a></td><td>Lets you reuse a set port if you need to. This just helps avoid weird bugs when testing locally that can occur</td></tr><tr><td>client_connection</td><td>This is another <code>Socket</code> object that represents the client connection to the server, it is what we use to get data, and send it back</td></tr><tr><td>client_address</td><td>The address (ipv4 in our case) for the client connecting to you</td></tr></tbody></table><p>From this we can then add in step 3:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> socket
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ip <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;127.0.0.1&#34;</span> <span style=color:#75715e># The IP address to use, this one specifies internal</span>
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> <span style=color:#ae81ff>8338</span> <span style=color:#75715e># The port to bind to</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> socket<span style=color:#f92672>.</span>socket(socket<span style=color:#f92672>.</span>AF_INET, socket<span style=color:#f92672>.</span>SOCK_STREAM) <span style=color:#66d9ef>as</span> s:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  s<span style=color:#f92672>.</span>setsockopt(socket<span style=color:#f92672>.</span>SOL_SOCKET, socket<span style=color:#f92672>.</span>SO_REUSEADDR, <span style=color:#ae81ff>1</span>) <span style=color:#75715e># Set internal socket to allow SO_REUSEADDR (1 means true)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Step 2</span>
</span></span><span style=display:flex><span>  s<span style=color:#f92672>.</span>bind((ip, port)) <span style=color:#75715e># Bind the configured socket to the server (assign ip address and port number to the socket instance)</span>
</span></span><span style=display:flex><span>  s<span style=color:#f92672>.</span>listen(<span style=color:#ae81ff>1</span>) <span style=color:#75715e># Listen for incoming connections</span>
</span></span><span style=display:flex><span>  client_connection, client_address <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>accept() <span style=color:#75715e># Accept connections and return details about them</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Step 3</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Get the client request</span>
</span></span><span style=display:flex><span>  raw_data <span style=color:#f92672>=</span> client_connection<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>4096</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> raw_data:
</span></span><span style=display:flex><span>      request <span style=color:#f92672>=</span> raw_data<span style=color:#f92672>.</span>decode() <span style=color:#75715e># Used to take the recieved data, and convert it to text</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>: 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;No raw data found&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  print(request) <span style=color:#75715e># The plaintext version of a request</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># The response would in our code be made by Server.generate_response()</span>
</span></span><span style=display:flex><span>  response <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;HTTP/1.1 200 OK</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&lt;h1&gt;Hello World&lt;/h1&gt;&#34;</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  client_connection<span style=color:#f92672>.</span>sendall(response<span style=color:#f92672>.</span>encode())  <span style=color:#75715e># Send the HTTP plaintext response back</span>
</span></span><span style=display:flex><span>  client_connection<span style=color:#f92672>.</span>shutdown(socket<span style=color:#f92672>.</span>SHUT_RDWR) <span style=color:#75715e># Tell the client we have  no additional responses to send them for now</span>
</span></span></code></pre></div><p>So, we can send data, all that&rsquo;s left is to replace the request parsing, and response generation with our server methods, and we&rsquo;re good to go&mldr;. right&mldr;</p><h3 id=common-gotchas>Common gotchas</h3><p>Networking is very finicky, and there&rsquo;s lots of weird problems that can arise such as:</p><ul><li>Clients/hosts losing connection mid-message</li><li>Multiple servers with their own configurations and rules potentially causing issues</li><li>Mostly everything being sent is just a bunch of strings. So all of the below are possible problems:<ul><li>Not doing data validation (Letters where there should be numbers, remote code execution etc.)</li><li>Using a different <a href=https://schulichignite.com/definitions/encoding/>encoding</a></li></ul></li></ul><p>But with all of these gotchas there&rsquo;s one we will need to make sure we code around&mldr;</p><h3 id=binary-vs-text-data>Binary vs Text data</h3><p>Files on your computer can be grouped in 2 common types. Text and Binary; Text is what we&rsquo;ve been working with so far. Things like source code, or just plain <code>.txt</code> files. Text files can just be read and understood. The contents of the file just need to be displayed to make them useful.</p><p>Binary files on the other hand are meant to be interpreted and/or executed. When you open a <code>.jpg</code> file you don&rsquo;t read the number values for the pixels, instead a program (like the windows photo viewer) interprets the data, and is executed to show you a human-understandable version of it. The same is true for binary executables like <code>.exe</code> files, which themselves are meant to &ldquo;run&rdquo;, not just be &ldquo;read&rdquo;.</p><p>The problem is that computers store these types of files differently. For text documents it&rsquo;s good enough to encode the text (using something like <code>"some data".encode()</code>) and send using <code>Socket.sendall()</code> (which sends all the data at once). Here is a stripped down example, imagine <code>client</code> in this case is a socket that is connected to the client, and we wanted to send the contents of <code>index.html</code> to them, we could do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> socket
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> socket<span style=color:#f92672>.</span>Socket() <span style=color:#66d9ef>as</span> client: <span style=color:#75715e># We will imagine this is a valid connection to the client</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Get data from file client is looking for</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;index.html&#34;</span>, <span style=color:#e6db74>&#34;r&#34;</span>) <span style=color:#66d9ef>as</span> response_file:
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> response_file<span style=color:#f92672>.</span>read() <span style=color:#75715e># Read plaintext data from file</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Generate full response</span>
</span></span><span style=display:flex><span>  response <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;HTTP/1.1 200 OK</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>server:hhttpp</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>{</span>data<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  client<span style=color:#f92672>.</span>sendall(response<span style=color:#f92672>.</span>encode()) <span style=color:#75715e># Encode and send the whole response</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Cleanup</span>
</span></span><span style=display:flex><span>  client_connection<span style=color:#f92672>.</span>shutdown(socket<span style=color:#f92672>.</span>SHUT_RDWR)
</span></span></code></pre></div><p>For binary files however the first line of a Request/Response and the headers are text, but the content could be something called a binary string (or binary data).</p><h4 id=how-binary-files-work>How binary files work</h4><p>Binary is a number system that uses base 2 instead of base 10 (if you&rsquo;re interested see <a href>this video</a> for details). We can actually see the binary versions of numbers in python by seting an <code>int</code> to base 2 instead of 10 by using <code>bin()</code> (we can also do base 16 using <code>hex()</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>bin(<span style=color:#ae81ff>256</span>) <span style=color:#75715e># &#39;0b100000000&#39;</span>
</span></span><span style=display:flex><span>hex(<span style=color:#ae81ff>256</span>) <span style=color:#75715e># &#39;0x100&#39;</span>
</span></span></code></pre></div><p>You&rsquo;ll notice that the values we get back look like strings. This is because they are a text representation of numbers, where the first 2 digits tell you the type (<code>0b</code> for binary <code>0x</code> for hexedecimal). Everything we do on a computer eventually comes back to 1&rsquo;s and 0&rsquo;s (see <a href>this article</a> for more details). A group of 8 digit binary is called a byte (<code>0b00000000</code> to <code>0b11111111</code>), a single byte can be converted to a single hexedecimal number. A byte just so happens for a ton of reasons to be a nice way to split up binary numbers, and that&rsquo;s why we often use it in computer science.</p><p>Binary files are files that are composed of just 1&rsquo;s and 0&rsquo;s into bytes, and that&rsquo;s all they contain. If you were to try to look at a binary file you will often get incomprehensible nonsense because it&rsquo;s just a bunch of numbers.</p><h4 id=binarybyte-strings>Binary/byte Strings</h4><p>When we read a binary file we get a byte string. Which is a string of characters which split the file into bytes. From there we directly read the bytes. Images for example are often a collection of 3 numbers representing the RGB values of a colour for a given pixel. So an image file just puts those numbers into the file so each pixels numbers are just lined up next to each other. For example:</p><pre tabindex=0><code>(255, 255, 255)                             &lt;-- Original value of 1 pixel
(255, 255, 255), (0, 0, 0), (135, 135, 135) &lt;-- Original value of 3 pixels
0xFF0xFF0xFF                                &lt;-- Byte string value of 1 pixel
0xFF0xFF0xFF0x000x000x000x870x870x87        &lt;-- Byte string value of 3 pixels
</code></pre><p>To get this info in python we need to read/write our files with an extra b appended to the method (i.e. <code>wb</code> or <code>rb</code>). So to read the byte string of an image we would do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ice-caps.jpg&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(filename, <span style=color:#e6db74>&#34;rb&#34;</span>) <span style=color:#66d9ef>as</span> file:
</span></span><span style=display:flex><span>  data <span style=color:#f92672>=</span> file<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>data <span style=color:#75715e># b&#34;0xFF0xFF0xFF0x000x000x000x870x870x87&#34;</span>
</span></span></code></pre></div><p>Notice that byte strings have a <code>b</code> prefix before the string, this helps you differentiate. You can switch back to a string representation (sometimes) with <code>b"".decode()</code>.</p><p>Text files actually work the same way, and are stored the same, but we just hide the complexity. When we read text files we are supposed to specify an encoding (usually in <a href="https://blog.hubspot.com/website/what-is-utf-8#:~:text=UTF%2D8%20is%20an%20encoding,or%20%E2%80%9CUnicode%20Transformation%20Format.%E2%80%9D">UTF-8</a>, this encoding is what helps us interpret the characters properly. <a href=https://www.learnbyexample.org/python-open-function/>Here is a page</a> with additional details about <code>open()</code> but here is what is happening for you by default:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;data.txt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(filename, <span style=color:#e6db74>&#34;r&#34;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span>) <span style=color:#66d9ef>as</span> file:
</span></span><span style=display:flex><span>  data <span style=color:#f92672>=</span> file<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>data <span style=color:#75715e># &#34;some text&#34;</span>
</span></span></code></pre></div><p>When we call <code>"".encode()</code> on a string it reverses the encoding process, and goes back to a binary string).</p><h4 id=sending-binary-data-over-a-socket>Sending binary data over a socket</h4><p>Here is a stripped down example, imagine <code>client</code> in this case is a socket that is connected to the client, and we wanted to send the contents of <code>index.html</code> to them, we first send the text data, then we send the binary data:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> socket
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ice-caps.jpg&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> socket<span style=color:#f92672>.</span>Socket() <span style=color:#66d9ef>as</span> client: <span style=color:#75715e># We will imagine this is a valid connection to the client</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Get data from file client is looking for</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>with</span> open(filename, <span style=color:#e6db74>&#34;rb&#34;</span>) <span style=color:#66d9ef>as</span> response_file:
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> response_file<span style=color:#f92672>.</span>read() <span style=color:#75715e># Read binary data from file</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Send text data</span>
</span></span><span style=display:flex><span>  first_line_of_response <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;HTTP/1.1 200 OK</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>server:hhttpp</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  client_connection<span style=color:#f92672>.</span>send(first_line_of_response<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># Send Binary Data</span>
</span></span><span style=display:flex><span>  client_connection<span style=color:#f92672>.</span>sendall(data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Cleanup</span>
</span></span><span style=display:flex><span>  client_connection<span style=color:#f92672>.</span>shutdown(socket<span style=color:#f92672>.</span>SHUT_RDWR)
</span></span></code></pre></div><p>So the full version of this process would be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> socket
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ip <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;127.0.0.1&#34;</span> <span style=color:#75715e># The IP address to use, this one specifies internal</span>
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> <span style=color:#ae81ff>8338</span> <span style=color:#75715e># The port to bind to</span>
</span></span><span style=display:flex><span>filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ice-caps.jpg&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> socket<span style=color:#f92672>.</span>socket(socket<span style=color:#f92672>.</span>AF_INET, socket<span style=color:#f92672>.</span>SOCK_STREAM) <span style=color:#66d9ef>as</span> s:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  s<span style=color:#f92672>.</span>setsockopt(socket<span style=color:#f92672>.</span>SOL_SOCKET, socket<span style=color:#f92672>.</span>SO_REUSEADDR, <span style=color:#ae81ff>1</span>) <span style=color:#75715e># Set internal socket to allow SO_REUSEADDR (1 means true)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Step 2</span>
</span></span><span style=display:flex><span>  s<span style=color:#f92672>.</span>bind((ip, port)) <span style=color:#75715e># Bind the configured socket to the server (assign ip address and port number to the socket instance)</span>
</span></span><span style=display:flex><span>  s<span style=color:#f92672>.</span>listen(<span style=color:#ae81ff>1</span>) <span style=color:#75715e># Listen for incoming connections</span>
</span></span><span style=display:flex><span>  client_connection, client_address <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>accept() <span style=color:#75715e># Accept connections and return details about them</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Step 3</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Get the client request</span>
</span></span><span style=display:flex><span>  raw_data <span style=color:#f92672>=</span> client_connection<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>4096</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> raw_data:
</span></span><span style=display:flex><span>      request <span style=color:#f92672>=</span> raw_data<span style=color:#f92672>.</span>decode() <span style=color:#75715e># Used to take the recieved data, and convert it to text</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>: 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;No raw data found&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  print(request) <span style=color:#75715e># The plaintext version of a request</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># Get data from file client is looking for</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>with</span> open(filename, <span style=color:#e6db74>&#34;rb&#34;</span>) <span style=color:#66d9ef>as</span> response_file:
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> response_file<span style=color:#f92672>.</span>read() <span style=color:#75715e># Read binary data from file</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Send text data</span>
</span></span><span style=display:flex><span>  first_line_of_response <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;HTTP/1.1 200 OK</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>server:hhttpp</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  client_connection<span style=color:#f92672>.</span>send(first_line_of_response<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># Send Binary Data</span>
</span></span><span style=display:flex><span>  client_connection<span style=color:#f92672>.</span>sendall(data)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  client_connection<span style=color:#f92672>.</span>shutdown(socket<span style=color:#f92672>.</span>SHUT_RDWR) <span style=color:#75715e># Tell the client we have  no additional responses to send them for now</span>
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>All this functionality was added to <code>Server.start_server()</code>, which you can see the source for <a href=https://github.com/Descent098/HHTTPP/blob/master/Post%203/Handmade%20HTTP%20Project/hhttpp/classes.py#L357-L412>here</a>!</p><h2 id=resources>Resources</h2><ul><li><a href=https://docs.python.org/3/library/socket.html>Socket module</a></li><li><a href=https://docs.python.org/3/howto/sockets.html>Official python socket howto</a></li><li><a href=https://realpython.com/python-sockets/>Another intro to sockets</a></li><li><a href="https://www.youtube.com/watch?v=onQTzTJ5sqU">Berkley Socket&rsquo;s (video)</a></li><li><a href="https://www.youtube.com/watch?v=3QiPPX-KeSc">Python Socket Programming Tutorial (video)</a></li><li><a href="https://www.youtube.com/watch?v=JNzfG7XMYSg">Socket Programming in Python(Simplified) - in 7 minutes! (Video, covers client and server)</a></li></ul></div><div class="card text-center"><div class=share-icons><h2>Share the article</h2><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fschulichignite.com%2fblog%2fhhttpp%2fimplementing-the-networking-portion%2f" target=_blank><i class="bi bi-facebook"></i></a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fschulichignite.com%2fblog%2fhhttpp%2fimplementing-the-networking-portion%2f" target=_blank><i class="bi bi-linkedin"></i></a>
<a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20post%20from%20schulich%20ignite%3A%0Ahttps%3a%2f%2fschulichignite.com%2fblog%2fhhttpp%2fimplementing-the-networking-portion%2f" target=_blank><i class="bi bi-twitter"></i></a></div><a href=../../../blog/index.xml target=_blank class=p-3>or subscribe to the blog with RSS <i class="bi bi-rss-fill"></i></a></div></div></div></div></div></section></body><footer class="footer sticky-bottom" style=position:fixed;background-color:#ffcdae><div class=container><div class=row><a href=https://www.instagram.com/schulichignite target=_blank rel="noopener noreferrer"><i class="bi bi-instagram is-large"></i></a>
<a href=https://www.youtube.com/channel/UC7tNvdbu952HOUl_4nK7iww target=_blank rel="noopener noreferrer"><i class="bi bi-youtube is-large"></i></a>
<a href=https://vm.tiktok.com/ZSHPbWU3/ target=_blank rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentcolor" class="bi bi-tiktok is-large mt-3" viewBox="0 0 16 16"><path d="M9 0h1.98c.144.715.54 1.617 1.235 2.512C12.895 3.389 13.797 4 15 4v2c-1.753.0-3.07-.814-4-1.829V11A5 5 0 116 6v2a3 3 0 103 3V0z"/></svg></a><a href=https://www.facebook.com/SchulichIgnite/ target=_blank rel="noopener noreferrer"><i class="bi bi-facebook is-large"></i></a>
<a href=https://linkedin.com/company/schulich-ignite/ target=_blank rel="noopener noreferrer"><i class="bi bi-linkedin is-large"></i></a>
<a href=https://discord.gg/F3Qjqqj target=_blank rel="noopener noreferrer"><i class="bi bi-discord is-large"></i></a></div></div></footer><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js integrity=sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js integrity="sha512-bgHRAiTjGrzHzLyKOnpFvaEpGzJet3z4tZnXGjpsCcqOnAH6VGUx9frc5bcIhKTVLEiCO6vEhNAgx5jtLUYrfA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/django.min.js integrity="sha512-1NHUMVlHsFnOe0Q36JMbBrNrjVcMdue2occC2xHWYXo7epa3YR54ZibI1G4I+tnJKBGNib11d8JzOElMfUSpYg==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/http.min.js integrity="sha512-4Rcwpn+xUuCDufCycA9UtpmboCxNHysWy23e45PJBQeh7m6Kno5/oQ4T5SmbmSAAZiDsm/IsX1IJwsOjy6ob0g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/http.min.js integrity="sha512-4Rcwpn+xUuCDufCycA9UtpmboCxNHysWy23e45PJBQeh7m6Kno5/oQ4T5SmbmSAAZiDsm/IsX1IJwsOjy6ob0g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>hljs.addPlugin(new CopyButtonPlugin),hljs.highlightAll(),hljs.initLineNumbersOnLoad()</script><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.esm.min.mjs';
    
    let mermaidConfig = {
    startOnLoad: true,
    "theme": "base",
        "themeVariables": {
            "primaryColor": "#ffde59",
            "primaryTextColor": "#d14b3b",
            "primaryBorderColor": "#7C0000",
            "lineColor": "#F8B229",
            "secondaryColor": "#fff",
            "tertiaryColor": "#d14b3b"
        }
    }
    mermaid.initialize(mermaidConfig, '.language-mermaid');
</script><script>window.onload=()=>{words={},articleContent=document.getElementById("article-content").innerHTML,contentSections=articleContent.match(/<p>(.*?)<\/p>|<ul>(.*?)<\/ul>|<ol>(.*?)<\/ol>/g),contentSections.forEach(e=>{for(word in words)searchMask=` ${word} |^${word} |${word}$| ${word}$|${word},`,regEx=new RegExp(searchMask,"igm"),newval=`${e}`.replace(regEx,` <a href="${words[word][0]}" target="_blank" data-toggle="tooltip" data-placement="top" title="${words[word][1]}">${word}</a> `),document.getElementById("article-content").innerHTML=document.getElementById("article-content").innerHTML.replace(e,newval)}),$(function(){$('[data-toggle="tooltip"]').tooltip()})}</script></html>