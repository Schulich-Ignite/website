import $ from"jquery";import Util from"./util";const ScrollSpy=(t=>{const e="scrollspy",s="bs.scrollspy",i="."+s,r=t.fn[e],l={offset:10,method:"auto",target:""},o={offset:"number",method:"string",target:"(string|element)"},n={ACTIVATE:"activate"+i,SCROLL:"scroll"+i,LOAD_DATA_API:`load${i}.data-api`},h="dropdown-item",a="active",c='[data-spy="scroll"]',f=".active",g=".nav, .list-group",_=".nav-link",d=".nav-item",u=".list-group-item",m=".dropdown",p=".dropdown-item",v=".dropdown-toggle",w="offset",E="position";class C{constructor(e,s){this._element=e,this._scrollElement="BODY"===e.tagName?window:e,this._config=this._getConfig(s),this._selector=`${this._config.target} ${_},${this._config.target} ${u},${this._config.target} ${p}`,this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,t(this._scrollElement).on(n.SCROLL,t=>this._process(t)),this.refresh(),this._process()}static get VERSION(){return"4.0.0"}static get Default(){return l}refresh(){const e=this._scrollElement===this._scrollElement.window?w:E,s="auto"===this._config.method?e:this._config.method,i=s===E?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight();t.makeArray(t(this._selector)).map(e=>{let r;const l=Util.getSelectorFromElement(e);if(l&&(r=t(l)[0]),r){const e=r.getBoundingClientRect();if(e.width||e.height)return[t(r)[s]().top+i,l]}return null}).filter(t=>t).sort((t,e)=>t[0]-e[0]).forEach(t=>{this._offsets.push(t[0]),this._targets.push(t[1])})}dispose(){t.removeData(this._element,s),t(this._scrollElement).off(i),this._element=null,this._scrollElement=null,this._config=null,this._selector=null,this._offsets=null,this._targets=null,this._activeTarget=null,this._scrollHeight=null}_getConfig(s){if("string"!=typeof(s={...l,...s}).target){let i=t(s.target).attr("id");i||(i=Util.getUID(e),t(s.target).attr("id",i)),s.target="#"+i}return Util.typeCheckConfig(e,s,o),s}_getScrollTop(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop}_getScrollHeight(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}_getOffsetHeight(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height}_process(){const t=this._getScrollTop()+this._config.offset,e=this._getScrollHeight(),s=this._config.offset+e-this._getOffsetHeight();if(this._scrollHeight!==e&&this.refresh(),t>=s){const t=this._targets[this._targets.length-1];this._activeTarget!==t&&this._activate(t)}else{if(this._activeTarget&&t<this._offsets[0]&&this._offsets[0]>0)return this._activeTarget=null,void this._clear();for(let e=this._offsets.length;e--;){this._activeTarget!==this._targets[e]&&t>=this._offsets[e]&&(void 0===this._offsets[e+1]||t<this._offsets[e+1])&&this._activate(this._targets[e])}}}_activate(e){this._activeTarget=e,this._clear();let s=this._selector.split(",");s=s.map(t=>`${t}[data-target="${e}"],${t}[href="${e}"]`);const i=t(s.join(","));i.hasClass(h)?(i.closest(m).find(v).addClass(a),i.addClass(a)):(i.addClass(a),i.parents(g).prev(`${_}, ${u}`).addClass(a),i.parents(g).prev(d).children(_).addClass(a)),t(this._scrollElement).trigger(n.ACTIVATE,{relatedTarget:e})}_clear(){t(this._selector).filter(f).removeClass(a)}static _jQueryInterface(e){return this.each((function(){let i=t(this).data(s);if(i||(i=new C(this,"object"==typeof e&&e),t(this).data(s,i)),"string"==typeof e){if(void 0===i[e])throw new TypeError(`No method named "${e}"`);i[e]()}}))}}return t(window).on(n.LOAD_DATA_API,()=>{const e=t.makeArray(t(c));for(let s=e.length;s--;){const i=t(e[s]);C._jQueryInterface.call(i,i.data())}}),t.fn[e]=C._jQueryInterface,t.fn[e].Constructor=C,t.fn[e].noConflict=function(){return t.fn[e]=r,C._jQueryInterface},C})($);export default ScrollSpy;