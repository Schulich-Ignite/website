import $ from"jquery";import Popper from"popper.js";import Util from"./util";const Dropdown=(t=>{const e="dropdown",n="bs.dropdown",o=t.fn[e],s=new RegExp("38|40|27"),r="click.bs.dropdown.data-api",i="keydown.bs.dropdown.data-api",a="disabled",l="show",h="dropup",d="dropdown-menu-right",p='[data-toggle="dropdown"]',c=".dropdown-menu",u={offset:0,flip:!0,boundary:"scrollParent"},f={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)"};class g{constructor(t,e){this._element=t,this._popper=null,this._config=this._getConfig(e),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}static get VERSION(){return"4.0.0"}static get Default(){return u}static get DefaultType(){return f}toggle(){if(this._element.disabled||t(this._element).hasClass(a))return;const e=g._getParentFromElement(this._element),n=t(this._menu).hasClass(l);if(g._clearMenus(),n)return;const o={relatedTarget:this._element},s=t.Event("show.bs.dropdown",o);if(t(e).trigger(s),!s.isDefaultPrevented()){if(!this._inNavbar){if(void 0===Popper)throw new TypeError("Bootstrap dropdown require Popper.js (https://popper.js.org)");let n=this._element;t(e).hasClass(h)&&(t(this._menu).hasClass("dropdown-menu-left")||t(this._menu).hasClass(d))&&(n=e),"scrollParent"!==this._config.boundary&&t(e).addClass("position-static"),this._popper=new Popper(n,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===t(e).closest(".navbar-nav").length&&t("body").children().on("mouseover",null,t.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),t(this._menu).toggleClass(l),t(e).toggleClass(l).trigger(t.Event("shown.bs.dropdown",o))}}dispose(){t.removeData(this._element,n),t(this._element).off(".bs.dropdown"),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}update(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}_addEventListeners(){t(this._element).on("click.bs.dropdown",t=>{t.preventDefault(),t.stopPropagation(),this.toggle()})}_getConfig(n){return n={...this.constructor.Default,...t(this._element).data(),...n},Util.typeCheckConfig(e,n,this.constructor.DefaultType),n}_getMenuElement(){if(!this._menu){const e=g._getParentFromElement(this._element);this._menu=t(e).find(c)[0]}return this._menu}_getPlacement(){const e=t(this._element).parent();let n="bottom-start";return e.hasClass(h)?(n="top-start",t(this._menu).hasClass(d)&&(n="top-end")):e.hasClass("dropright")?n="right-start":e.hasClass("dropleft")?n="left-start":t(this._menu).hasClass(d)&&(n="bottom-end"),n}_detectNavbar(){return t(this._element).closest(".navbar").length>0}_getPopperConfig(){const t={};return"function"==typeof this._config.offset?t.fn=t=>(t.offsets={...t.offsets,...this._config.offset(t.offsets)||{}},t):t.offset=this._config.offset,{placement:this._getPlacement(),modifiers:{offset:t,flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}}}static _jQueryInterface(e){return this.each((function(){let o=t(this).data(n);if(o||(o=new g(this,"object"==typeof e?e:null),t(this).data(n,o)),"string"==typeof e){if(void 0===o[e])throw new TypeError(`No method named "${e}"`);o[e]()}}))}static _clearMenus(e){if(e&&(3===e.which||"keyup"===e.type&&9!==e.which))return;const o=t.makeArray(t(p));for(let s=0;s<o.length;s++){const r=g._getParentFromElement(o[s]),i=t(o[s]).data(n),a={relatedTarget:o[s]};if(!i)continue;const h=i._menu;if(!t(r).hasClass(l))continue;if(e&&("click"===e.type&&/input|textarea/i.test(e.target.tagName)||"keyup"===e.type&&9===e.which)&&t.contains(r,e.target))continue;const d=t.Event("hide.bs.dropdown",a);t(r).trigger(d),d.isDefaultPrevented()||("ontouchstart"in document.documentElement&&t("body").children().off("mouseover",null,t.noop),o[s].setAttribute("aria-expanded","false"),t(h).removeClass(l),t(r).removeClass(l).trigger(t.Event("hidden.bs.dropdown",a)))}}static _getParentFromElement(e){let n;const o=Util.getSelectorFromElement(e);return o&&(n=t(o)[0]),n||e.parentNode}static _dataApiKeydownHandler(e){if(/input|textarea/i.test(e.target.tagName)?32===e.which||27!==e.which&&(40!==e.which&&38!==e.which||t(e.target).closest(c).length):!s.test(e.which))return;if(e.preventDefault(),e.stopPropagation(),this.disabled||t(this).hasClass(a))return;const n=g._getParentFromElement(this),o=t(n).hasClass(l);if(!o&&(27!==e.which||32!==e.which)||o&&(27===e.which||32===e.which)){if(27===e.which){const e=t(n).find(p)[0];t(e).trigger("focus")}return void t(this).trigger("click")}const r=t(n).find(".dropdown-menu .dropdown-item:not(.disabled)").get();if(0===r.length)return;let i=r.indexOf(e.target);38===e.which&&i>0&&i--,40===e.which&&i<r.length-1&&i++,i<0&&(i=0),r[i].focus()}}return t(document).on(i,p,g._dataApiKeydownHandler).on(i,c,g._dataApiKeydownHandler).on(r+" keyup.bs.dropdown.data-api",g._clearMenus).on(r,p,(function(e){e.preventDefault(),e.stopPropagation(),g._jQueryInterface.call(t(this),"toggle")})).on(r,".dropdown form",t=>{t.stopPropagation()}),t.fn[e]=g._jQueryInterface,t.fn[e].Constructor=g,t.fn[e].noConflict=function(){return t.fn[e]=o,g._jQueryInterface},g})($);export default Dropdown;